   

[![](https://p3-passport.byteimg.com/img/user-avatar/03ef9b966e83ef5c0e9b6522472cff63~100x100.awebp)](https://juejin.cn/user/3957869870592685)

2021å¹´12æœˆ02æ—¥ 16:43 Â·Â Â é˜…è¯» 9590

## ğŸŒ æ¦‚è®º

ä¼ ç»Ÿçš„å‰ç«¯éƒ¨ç½²å¾€å¾€éƒ½è¦ç»å†ï¼š`æœ¬åœ°ä»£ç æ›´æ–°` => `æœ¬åœ°æ‰“åŒ…é¡¹ç›®` => `æ¸…ç©ºæœåŠ¡å™¨ç›¸åº”ç›®å½•` => `ä¸Šä¼ é¡¹ç›®åŒ…è‡³ç›¸åº”ç›®å½•`å‡ ä¸ªé˜¶æ®µï¼Œè¿™äº›éƒ½æ˜¯æœºæ¢°é‡å¤çš„æ­¥éª¤ã€‚å¯¹äºè¿™ä¸€è¿‡ç¨‹æˆ‘ä»¬å¾€å¾€å¯ä»¥é€šè¿‡`CI/CD`æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚æ‰€è°“`CI/CD`ï¼Œå³æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²ï¼Œä»¥ä¸Šæˆ‘ä»¬æ‰€è¯´çš„æ­¥éª¤ä¾¿å¯ä»¥çœ‹ä½œæ˜¯æŒç»­éƒ¨ç½²çš„ä¸€ç§å½¢æ€ï¼Œå…¶æ›´è¯¦ç»†çš„è§£é‡Šå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£ã€‚

`Jenkins`ã€`Travis CI`è¿™äº›éƒ½æ˜¯å¯ä»¥å®ŒæˆæŒç»­éƒ¨ç½²çš„å·¥å…·ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ`Gitlab CI/CD`ä¹Ÿèƒ½å¾ˆå¥½çš„å®Œæˆè¿™ä¸€éœ€æ±‚ã€‚ä¸‹é¢å°±æ¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚

## ğŸŒ æ ¸å¿ƒå·¥å…·

### GitLab Runner

`GitLab Runner`æ˜¯é…åˆ`GitLab CI/CD`å®Œæˆå·¥ä½œçš„æ ¸å¿ƒç¨‹åºï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œ`GitLab Runner`åº”è¯¥ä¸`Gitlab`éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼ˆ`Gitlab`åœ¨å•ç‹¬çš„ä»“åº“æœåŠ¡å™¨ä¸Šï¼Œ`GitLab Runner`åœ¨éƒ¨ç½²webåº”ç”¨çš„æœåŠ¡å™¨ä¸Šï¼‰ã€‚`GitLab Runner`åœ¨ä¸`GitLab`å…³è”åï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆè¯¸å¦‚é¡¹ç›®æ‹‰å–ã€æ–‡ä»¶æ‰“åŒ…ã€èµ„æºå¤åˆ¶ç­‰å„ç§å‘½ä»¤æ“ä½œã€‚

### Git

webæœåŠ¡å™¨ä¸Šéœ€è¦å®‰è£…`Git`æ¥è¿›è¡Œè¿œç¨‹ä»“åº“çš„è·å–å·¥ä½œã€‚

### Node

ç”¨äºåœ¨webæœåŠ¡å™¨ä¸Šå®Œæˆæ‰“åŒ…å·¥ä½œã€‚

### NPM or Yarn or pnpm

ç”¨äºåœ¨webæœåŠ¡å™¨ä¸Šå®Œæˆä¾èµ–ä¸‹è½½ç­‰å·¥ä½œï¼ˆç”¨`yarn`,`pnpm`äº¦å¯ï¼‰ã€‚

![webæœåŠ¡å™¨ä¸Šçš„æ‰€éœ€ç¨‹åº](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4faad6113c4e46bb9e30b0cc36741ac0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

## ğŸŒ æµç¨‹

è¿™é‡Œæˆ‘è‡ªå·±ç”¨çš„æ˜¯centOSç¯å¢ƒï¼š

#### 1\. åœ¨webæœåŠ¡å™¨ä¸Šå®‰è£…æ‰€éœ€å·¥å…·

**ï¼ˆ1ï¼‰å®‰è£…Node**

```
# ä¸‹è½½nodeåŒ…
wget https://nodejs.org/dist/v16.13.0/node-v16.13.0-linux-x64.tar.xz
å¤åˆ¶ä»£ç 
```

```
# è§£å‹NodeåŒ…
tar -xf node-v16.13.0-linux-x64.tar.xz
å¤åˆ¶ä»£ç 
```

```
# åœ¨é…ç½®æ–‡ä»¶ï¼ˆä½ç½®å¤šåœ¨/etc/profileï¼‰æœ«å°¾æ·»åŠ ï¼š
export PATH=$PATH:/root/node-v16.13.0-linux-x64/bin
å¤åˆ¶ä»£ç 
```

```
# åˆ·æ–°shellç¯å¢ƒï¼š
source /etc/profile
å¤åˆ¶ä»£ç 
```

```
# æŸ¥çœ‹ç‰ˆæœ¬ï¼ˆè¾“å‡ºç‰ˆæœ¬å·åˆ™å®‰è£…æˆåŠŸï¼‰ï¼š
node -v

#åç»­å®‰è£…æ“ä½œï¼Œéƒ½å¯é€šè¿‡-væˆ–è€…--versionæ¥æŸ¥çœ‹æ˜¯å¦æˆåŠŸ
å¤åˆ¶ä»£ç 
```

`npm`å·²å†…ç½®åœ¨`node`ä¸­ï¼Œå¦‚è¦ä½¿ç”¨`yarn`æˆ–ï¼Œåˆ™å¯é€šè¿‡`npm`è¿›è¡Œå…¨å±€å®‰è£…ï¼Œå‘½ä»¤ä¸æˆ‘ä»¬æœ¬åœ°ç¯å¢ƒä¸‹çš„ä½¿ç”¨å‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼š

```
npm i yarn -g
#or
npm i pnpm -g
å¤åˆ¶ä»£ç 
```

**ï¼ˆ2ï¼‰å®‰è£…Git**

```
# åˆ©ç”¨yumå®‰è£…git
yum -y install git
å¤åˆ¶ä»£ç 
```

```
# æŸ¥çœ‹gitç‰ˆæœ¬
git --version
å¤åˆ¶ä»£ç 
```

**ï¼ˆ3ï¼‰å®‰è£…Gitlab Runner**

```
# å®‰è£…ç¨‹åº
wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64

# ç­‰å¾…ä¸‹è½½å®Œæˆååˆ†é…æƒé™
chmod +x /usr/local/bin/gitlab-runner

# åˆ›å»ºrunnerç”¨æˆ·
useradd --comment 'test' --create-home gitlab-runner --shell /bin/bash

# å®‰è£…ç¨‹åº
gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner

# å¯åŠ¨ç¨‹åº
gitlab-runner start

# å®‰è£…å®Œæˆåå¯ä½¿ç”¨gitlab-runner --versionæŸ¥çœ‹æ˜¯å¦æˆåŠŸ
å¤åˆ¶ä»£ç 
```

#### 2\. é…ç½®RunneråŠCI/CD

åŸºæœ¬çš„å®‰è£…æ“ä½œå®Œæˆåï¼Œå°±æ˜¯æœ€æ ¸å¿ƒçš„é˜¶æ®µï¼šRunnerä¸CI/CDçš„é…ç½®ã€‚

**ï¼ˆ1ï¼‰é…ç½®Gitlab Runner**

é¦–å…ˆæ‰“å¼€å¾…æ·»åŠ è‡ªåŠ¨éƒ¨ç½²åŠŸèƒ½çš„gitlabä»“åº“ï¼Œåœ¨å…¶ä¸­`è®¾ç½® > CI/CD > Runner`ä¸­æ‰¾åˆ°runneré…ç½®ä¿¡æ¯å¤‡ç”¨ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/080073fabd24491ba15784196a8f0376~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

åœ¨webæœåŠ¡å™¨ä¸­é…ç½®runnerï¼š

```
gitlab-runner register

>> Enter the GitLab instance URL (for example, https://gitlab.com/):
# è¾“å…¥åˆšæ‰è·å–åˆ°çš„gitlabä»“åº“åœ°å€
>> Enter the registration token:
# è¾“å…¥åˆšæ‰è·å–åˆ°çš„token
>> Enter a description for the runner:
# è‡ªå®šrunneræè¿°
>> Enter tags for the runner (comma-separated):
# è‡ªå®šrunneræ ‡ç­¾
>> Enter an executor: docker-ssh, docker+machine, docker-ssh+machine, docker, parallels, shell, ssh, virtualbox, kubernetes, custom:
# é€‰æ‹©æ‰§è¡Œå™¨ï¼Œæ­¤å¤„æˆ‘ä»¬è¾“å…¥shell
å¤åˆ¶ä»£ç 
```

å®Œæ•´ç¤ºä¾‹ï¼š ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de5f7e8dac434bd1bed887b314129bdc~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

**ï¼ˆ2ï¼‰é…ç½®.gitlab-ci.yml**

`.gitlab-ci.yml`æ–‡ä»¶æ˜¯æµæ°´çº¿æ‰§è¡Œçš„æµç¨‹æ–‡ä»¶ï¼ŒRunnerä¼šæ®æ­¤å®Œæˆè§„å®šçš„ä¸€ç³»åˆ—æµç¨‹ã€‚

æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»º`.gitlab-ci.yml`æ–‡ä»¶ï¼Œç„¶ååœ¨å…¶ä¸­ç¼–å†™å†…å®¹ï¼š

```
# é˜¶æ®µ
stages:
  - install
  - build
  - deploy

cache:
  paths:
    - node_modules/

# å®‰è£…ä¾èµ–
install:
  stage: install
  # æ­¤å¤„çš„tagså¿…é¡»å¡«å…¥ä¹‹å‰æ³¨å†Œæ—¶è‡ªå®šçš„tag
  tags: 
    - deploy
  # è§„å®šä»…åœ¨package.jsonæäº¤æ—¶æ‰è§¦å‘æ­¤é˜¶æ®µ
  only:
    changes:
      - package.json
  # æ‰§è¡Œè„šæœ¬
  script:
    yarn

# æ‰“åŒ…é¡¹ç›®
build:
  stage: build 
  tags: 
    - deploy
  script: 
    - yarn build
  # å°†æ­¤é˜¶æ®µäº§ç‰©ä¼ é€’è‡³ä¸‹ä¸€é˜¶æ®µ 
  artifacts: 
    paths:
        - dist/

# éƒ¨ç½²é¡¹ç›®
deploy:
  stage: deploy
  tags: 
    - deploy
  script: 
    # æ¸…ç©ºç½‘ç«™æ ¹ç›®å½•ï¼Œç›®å½•è¯·æ ¹æ®æœåŠ¡å™¨å®é™…æƒ…å†µå¡«å†™
    - rm -rf /www/wwwroot/stjerne/salary/*
    # å¤åˆ¶æ‰“åŒ…åçš„æ–‡ä»¶è‡³ç½‘ç«™æ ¹ç›®å½•ï¼Œç›®å½•è¯·æ ¹æ®æœåŠ¡å™¨å®é™…æƒ…å†µå¡«å†™
    - cp -rf ${CI_PROJECT_DIR}/dist/* /www/wwwroot/stjerne/salary/ 
å¤åˆ¶ä»£ç 
```

ä¿å­˜å¹¶æ¨é€è‡³gitlabåå³å¯è‡ªåŠ¨å¼€å§‹æ„å»ºéƒ¨ç½²ã€‚

æ„å»ºä¸­å¯åœ¨gitlab CI/CDé¢æ¿æŸ¥çœ‹æ„å»ºè¿›ç¨‹ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43e6e692181f46ab9fc7f1a87bf968ac~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

å¾…æµæ°´çº¿JOBå®Œæˆåå¯å‰å¾€é¡µé¢æŸ¥çœ‹ğŸ›«ğŸ›«ğŸ›«ğŸ›«ğŸ›«

æ–‡ç« è¢«æ”¶å½•äºä¸“æ ï¼š

![cover](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95414745836549ce9143753e2a30facd~tplv-k3u1fbpfcp-no-mark:160:160:160:120.awebp)

![](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/00ba359ecd0075e59ffbc3d810af551d.svg) 161

![](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/3d482c7a948bac826e155953b2a28a9e.svg) æ”¶è—