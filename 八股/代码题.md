# ä»£ç é¢˜

## æ‰‹å†™é¢˜

### 1.æ‰‹å†™é˜²æŠ–å‡½æ•°

è®¾ç½®clearTimeoutä¸ºä»€ä¹ˆè¿˜è¦timer=null
è®¾ç½®å»¶æ—¶å™¨ä¹‹å‰å…ˆæ¸…é™¤ä¸‹å»¶æ—¶å™¨ï¼Œä¸ç„¶æ¯æ¬¡äº‹ä»¶è§¦å‘éƒ½ä¼šå¤šä¸€ä¸ªå»¶æ—¶å™¨ï¼Œå»¶æ—¶å™¨ä¹‹é—´äº’ç›¸å¹²æ‰°ï¼Œé€ æˆç´Šä¹±ã€‚

```js
function debounce(fn,delay){
	let timer;
	return function(...args){
		if(timer){
			clearTimeout(timer);
              timer=null;
		}
		timer=setTimeout(()=>{
			fn.apply(this,args)
		},delay);
	}
}
//æµ‹è¯•
function task(){
	console.log('run task')
}
const debounceTask=debounce(task,1000)
window.addEventListener('scroll',debounceTask);
```

### 2.æ‰‹å†™èŠ‚æµå‡½æ•°

```js
function throttle(fn,delay){
	let last=0;
	return (...args)=>{
		const now =Date.now();
		if(now-last>delay){
			last=now;
			fn.apply(this,args)
		}
	}
}
function task(){
	console.log('run task')
}
const throttleTask=throttle(task,1000);
window.addEventListener('scroll',throttleTask);
```

### 3.æ‰‹å†™æµ…æ‹·è´æ·±æ‹·è´

æµ…æ‹·è´æ˜¯æŒ‡ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å¯¹åŸå§‹å¯¹è±¡çš„å±æ€§å€¼è¿›è¡Œç²¾ç¡®åœ°æ‹·è´ï¼Œå¦‚æœæ‹·è´çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œå¦‚æœæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨å†…å­˜åœ°å€å‘ç”Ÿæ”¹å˜ï¼Œå¦ä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚

#### æµ…æ‹·è´

##### Object.assign()

Object.assign() æ˜¯ES6ä¸­å¯¹è±¡çš„æ‹·è´æ–¹æ³•ï¼Œæ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œå…¶ä½™å‚æ•°æ˜¯æºå¯¹è±¡ï¼Œç”¨æ³•ï¼š Object.assign(target, source1, Â·Â·Â·) ï¼Œè¯¥æ–¹æ³•å¯ä»¥å®ç°æµ…æ‹·è´ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸€ç»´å¯¹è±¡
çš„æ·±æ‹·è´ã€‚

```js
let target = {a: 1};
let object2 = {b: 2};
let object3 = {c: 3};
Object.assign(target,object2,object3);
console.log(target); // {a: 1, b: 2, c: 3}
```

##### æ‰©å±•è¿ç®—ç¬¦

ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦å¯ä»¥åœ¨æ„é€ å­—é¢é‡å¯¹è±¡çš„æ—¶å€™ï¼Œè¿›è¡Œå±æ€§çš„æ‹·è´ã€‚è¯­æ³•ï¼š let cloneObj = {...obj };

```js
let obj1 = {a:1,b:{c:1}
let obj2 = {...obj1};
obj1.a = 2;
console.log(obj1); 
//{a:2,b:{c:1}}
console.log(obj2);
//{a:1,b:{c:1}}
obj1.b.c = 2;
console.log(obj1); 
//{a:2,b:{c:2}}
console.log(obj2); 
//{a:1,b:{c:2
```

##### æ•°ç»„æ–¹æ³•å®ç°æ•°ç»„æµ…æ‹·è´

###### Array.prototype.slice()

array.slice(start, end)

ä»å·²æœ‰æ•°ç»„ä¸­è¿”å›é€‰å®šçš„å…ƒç´ ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸¤ä¸ªå‚æ•°éƒ½å¯é€‰ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°éƒ½ä¸å†™ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªæ•°ç»„çš„æµ…æ‹·è´

###### Array.prototype.concat()

concat() ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„  è¿”å›ä¸€ä¸ªæ–°æ•°ç»„

##### æ‰‹å†™æµ…æ‹·è´

```js
function shallowCopy(object){
		if(!object||typeof object!=="object") return
  	let newObject=Array.isArray(object)?[]:{}
    for(let key in object){
      if(object.hasOwnProperty(key)){
        newObject[key]=object[key]
      }
    }
  return newObject
}
```



#### æ·±æ‹·è´

##### JSON.stringify()

`JSON.parse(JSON.stringify(obj))`   åŸç†å°±æ˜¯åˆ©ç”¨
`JSON.stringify` å°† js å¯¹è±¡åºåˆ—åŒ–ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰ï¼Œå†ä½¿ç”¨`JSON.parse` æ¥ååºåˆ—åŒ–(è¿˜åŸ)js å¯¹è±¡

æ‹·è´çš„å¯¹è±¡ä¸­å¦‚æœæœ‰å‡½æ•°ï¼Œundefinedï¼Œ
symbolï¼Œå½“ä½¿ç”¨è¿‡ JSON.stringify() è¿›è¡Œå¤„ç†ä¹‹åï¼Œéƒ½ä¼šæ¶ˆå¤±

```js
let obj1 = { a: 0,b: {c: 0}};
let obj2 = JSON.parse(JSON.stringify(obj1)
obj1.a = 1;
obj1.b.c = 1;
console.log(obj1); // {a: 1, b: {c: 1}}
console.log(obj2); // {a: 0, b: {c: 0}}
```



##### æ‰‹å†™æ·±æ‹·è´

```js
function deepClone(obj) {
        let result;
        if (typeof obj == "object") {
          if (obj == null) {
            result = obj;
          } else if (obj instanceof RegExp) {
            result = new RegExp(obj);
          } else if (obj instanceof Date) {
            result = new Date(obj);
          } else if (Array.isArray(obj)) {
            result = [];
            for (let key of obj) {
              result.push(deepClone(key));
            }
          } else {
            result = {};
            for (let key in obj) {
              if (!result.hasOwnProperty(key)) {
                result[key] = deepClone(obj[key]);
              }
            }
          }
        } else {
          result = obj;
        }
        return result;
      }
      let m = {
        a: 1,
        b: ["name", "xxx"],
        c: /^g/,
        d: { e: 1 },
        f: function (a, b) {
          console.log(666);
        },
      };

      console.log(deepClone(m));
```

```js
 function clone(target) {
    if (typeof target === 'object') {
        let cloneTarget = Array.isArray(target) ? [] : {};
        for (const key in target) {
            cloneTarget[key] = clone(target[key]);
        }
        return cloneTarget;
    } else {
        return target;
    }
};
```

##### è§£å†³å¾ªç¯å¼•ç”¨å’Œsymbol

```js

const obj = {
	name: "cc",
	age: 30,
	job: { type: "porgrammer", com: "ali" },
	cars: ["passat", "bmw"],
	working: function (str) {
		console.log(`æˆ‘æ˜¯${this.name},æˆ‘æ­£åœ¨${str}`)
	},
	da: new Date(),
	reg: new RegExp(),
	xx: undefined ,
};
obj.f=obj


function clone(obj, map = new Map()) {
	if (typeof obj != 'object') return
	var newObj = Array.isArray(obj) ? [] : {}
	if (map.get(obj)) {
		return map.get(obj);
	}
	map.set(obj, newObj);
	for (var key in obj) {
		if (obj.hasOwnProperty(key)) {
			if (typeof obj[key] == 'object') {
				newObj[key] = clone(obj[key], map);
			} else {
				newObj[key] = obj[key];
			}
		}
	}
	return newObj;
}

var copyobj = clone(obj)
console.log(copyobj);

```



```js
// ç»ˆæè§£å†³æ–¹æ¡ˆï¼Œæ»¡è¶³å¾ªç¯å¼•ç”¨å’Œsymbol
//åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
function isPrimitive(value){
  return (typeof value === 'string' || 
  typeof value === 'number' || 
  typeof value === 'symbol' ||
  typeof value === 'boolean')
}
 
//åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªjså¯¹è±¡
function isObject(value){
  return Object.prototype.toString.call(value) === "[object Object]"
}
 
//æ·±æ‹·è´ä¸€ä¸ªå€¼
function cloneEnDeep(value){
  // è®°å½•è¢«æ‹·è´çš„å€¼ï¼Œé¿å…å¾ªç¯å¼•ç”¨çš„å‡ºç°
    let memo = {};
    function baseClone(value){
        let res;
        // å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›
        if(isPrimitive(value)){
            return value;
        // å¦‚æœæ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬æµ…æ‹·è´ä¸€ä¸ªæ–°å€¼æ¥ä»£æ›¿åŸæ¥çš„å€¼
        }else if(Array.isArray(value)){
            res = [...value];
        }else if(isObject(value)){
            res = {...value};
        }
 
        // æ£€æµ‹æˆ‘ä»¬æµ…æ‹·è´çš„è¿™ä¸ªå¯¹è±¡çš„å±æ€§å€¼æœ‰æ²¡æœ‰æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚å¦‚æœæ˜¯ï¼Œåˆ™é€’å½’æ‹·è´
        //åŒæ—¶ä½¿ç”¨Reflectå¯ä»¥æ£€æµ‹åˆ°Symbolç±»å‹çš„å±æ€§
        Reflect.ownKeys(res).forEach(key=>{
            if(typeof res[key] === "object" && res[key]!== null){
                //æ­¤å¤„æˆ‘ä»¬ç”¨memoæ¥è®°å½•å·²ç»è¢«æ‹·è´è¿‡çš„å¼•ç”¨åœ°å€ã€‚ä»¥æ­¤æ¥è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜
                if(memo[res[key]]){
                res[key] = memo[res[key]];
                }else{
                memo[res[key]] = res[key];
                res[key] = baseClone(res[key])
                }
            }
        })
        return res;  
    }
    return baseClone(value)
}
 
//======================æµ‹è¯•====================
 //å®šä¹‰ä¸€ä¸ªå‘˜å·¥ä¸ªäººå¯¹è±¡
 let objP = {
            name:"cc",
            age:30,
            job:{type:"porgrammer",com:"ali"},
            cars:["passat","bmw"],
            working:function(str){
                console.log(`æˆ‘æ˜¯${this.name},æˆ‘æ­£åœ¨${str}`)
            },
            da:new Date(),
            reg: new RegExp(),
            xx:undefined
        }
 
objP.job = objP;//å¾ªç¯å¼•ç”¨
console.log(obj);
console.log(getPerInf(obj));
console.log(obj);
obj.working("åƒé¥­");
```



### 4.æ‰‹å†™ajax

```js
function handleGet(url) {
        var response = "";
        //1.åˆ›å»ºå¯¹è±¡
        var xhr = new XMLHttpRequest();
        //2.è®¾ç½®æ–¹æ³•
        xhr.open("GET", "http://127.0.0.1:8080/user");
        //3.å‘é€è¯·æ±‚
        xhr.send();
        //4.è¿”å›ç»“æœ
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              response = xhr.responseText;
              console.log(response, "1");
            } else {
              return "Error" + xhr.status;
            }
          }
        };
      }
```

### 5.ä½¿ç”¨promiseå®ç°ajax

```js
// promise å°è£…å®ç°ï¼š
function getJSON(url) {
  // åˆ›å»ºä¸€ä¸ª promise å¯¹è±¡
  let promise = new Promise(function(resolve, reject) {
    let xhr = new XMLHttpRequest();
    // æ–°å»ºä¸€ä¸ª http è¯·æ±‚
    xhr.open("GET", url, true);
    // è®¾ç½®çŠ¶æ€çš„ç›‘å¬å‡½æ•°
    xhr.onreadystatechange = function() {
      if (this.readyState !== 4) return;
      // å½“è¯·æ±‚æˆåŠŸæˆ–å¤±è´¥æ—¶ï¼Œæ”¹å˜ promise çš„çŠ¶æ€
      if (this.status === 200) {
        resolve(this.response);
      } else {
        reject(new Error(this.statusText));
      }
    };
    // è®¾ç½®é”™è¯¯ç›‘å¬å‡½æ•°
    xhr.onerror = function() {
      reject(new Error(this.statusText));
    };
    // è®¾ç½®å“åº”çš„æ•°æ®ç±»å‹
    xhr.responseType = "json";
    // è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯
    xhr.setRequestHeader("Accept", "application/json");
    // å‘é€ http è¯·æ±‚
    xhr.send(null);
  });
  return promise;
}
```



### 6.æ‰‹å†™ apply  call  bind

#### applyå®ç°

åˆ¤æ–­è°ƒç”¨å¯¹è±¡æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå³ä½¿æˆ‘ä»¬æ˜¯å®šä¹‰åœ¨å‡½æ•°çš„åŸå‹ä¸Šçš„ï¼Œä½†æ˜¯å¯èƒ½å‡ºç°ä½¿ç”¨ call ç­‰æ–¹å¼è°ƒç”¨çš„æƒ…å†µã€‚

åˆ¤æ–­ä¼ å…¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ä¸º window ã€‚

å°†å‡½æ•°ä½œä¸ºä¸Šä¸‹æ–‡å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚

åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ä¼ å…¥

ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¿å­˜è¿”å›ç»“æœã€‚

åˆ é™¤åˆšæ‰æ–°å¢çš„å±æ€§

è¿”å›ç»“æœ



```js
Function.prototype.myApply=function (context,...args){
    if(typeof this !=="function"){
        return new Error('typeError')
    }
    context.fn=this
    if(args){
        result=context.fn(...args)
    }else{
        result=context.fn()
    }
    delete context.fn
    return result
}
let obj = {
        a: 10,
        b: 20,
      };
function sum(a, b) {
        this.b = 100;
        console.log(this.a, this.b);
        return a + b;
      }
sum.myApply(obj, 10, 20);
```

#### callå®ç°

åˆ¤æ–­è°ƒç”¨å¯¹è±¡æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå³ä½¿æˆ‘ä»¬æ˜¯å®šä¹‰åœ¨å‡½æ•°çš„åŸå‹ä¸Šçš„ï¼Œä½†æ˜¯å¯èƒ½å‡ºç°ä½¿ç”¨ call ç­‰æ–¹å¼è°ƒç”¨çš„æƒ…å†µã€‚

åˆ¤æ–­ä¼ å…¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ä¸º window ã€‚

å¤„ç†ä¼ å…¥çš„å‚æ•°ï¼Œæˆªå–ç¬¬ä¸€ä¸ªå‚æ•°åçš„æ‰€æœ‰å‚æ•°ã€‚

å°†å‡½æ•°ä½œä¸ºä¸Šä¸‹æ–‡å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚

ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¿å­˜è¿”å›ç»“æœã€‚

åˆ é™¤åˆšæ‰æ–°å¢çš„å±æ€§ã€‚

è¿”å›ç»“æœã€‚

```js
 Function.prototype.myCall = function (context) {
        context = context || window;
        if (typeof this !== "function") {
          throw new Error("typeError");
        }
        let result;
        context.fn = this;
        let args = [...arguments].slice(1);
        if (args) {
          result = context.fn(...args);
        } else {
          result = context.fn();
        }
        delete context.fn;
        return result;
      };
      var obj = {
        n: 15,
      };
      function sum(n, m) {
        console.log(this);
        return n + m;
      }

      console.log(sum.myCall(obj, 10, 20));
```

#### bindå®ç°

```js
// bind å‡½æ•°å®ç°
Function.prototype.myBind = function(context) {
  // åˆ¤æ–­è°ƒç”¨å¯¹è±¡æ˜¯å¦ä¸ºå‡½æ•°
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }
  // è·å–å‚æ•°
  var args = [...arguments].slice(1),
     fn = this;
  return function Fn() {
    // æ ¹æ®è°ƒç”¨æ–¹å¼ï¼Œä¼ å…¥ä¸åŒç»‘å®šå€¼
    return fn.apply(
      this instanceof Fn ? this : context,
      args.concat(...arguments)
    );
  };
};
var obj = {
        n: 15,
      };
function sum(n, m) {
        console.log(this);
        return n + m;
      }
var ans=sum.myBind(obj, 10, 20)
console.log(ans());
```



### 7.æ‰‹å†™promise.all

```js
function myPromiseAll(arrayList) {
        return new Promise((resolve, reject) => {
          let resultArr = [],
            count = 0;
          let length = arrayList.length;
          for (let i = 0; i < length; i++) {
            Promise.resolve(arrayList[i]).then(
              (result) => {
                count++;
                resultArr[i] = result;
                if (count == length) {
                  resolve(resultArr);
                }
              },
              (err) => {
                return reject(err);
              }
            );
          }
        });
      }

function test(num, delay) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            num == 4 ? reject(num) : resolve(num);
          }, delay);
        });
      }
      let p1 = test(1, 1000);
      let p2 = test(2, 2000);
      let p3 = test(3, 3000);
      let p4 = test(4, 4000);
      myPromiseAll([p1, p2, p3]).then((result) => {
        console.log(result);
      });
```



### 8.æ‰‹å†™promise.race

```js
function PromiseRace(arrayList) {
        return new Promise((resolve) => {
          for (let i = 0; i < arrayList.length; i++) {
            Promise.resolve(arrayList[i]).then((result) => {
              resolve(result);
            });
          }
        });
      }
      function test(num, time) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            num == 4 ? reject() : resolve(num);
          }, time);
        });
      }
      let p1 = test(1, 2000);
      let p2 = test(2, 1000);
      let p3 = test(3, 5000);
      PromiseRace([p3, p1, p2]).then((res) => {
        console.log(res);
      });
```



### 9.å®ç°å‡½æ•°ç§‘é‡ŒåŒ–

#### 1.å›ºå®šå‚æ•°

ç†è§£  argæ•°ç»„æ˜¯ä¸æ–­è¢«æ‰©å±•çš„ lengthæŒ‡çš„æ˜¯ä¼ å…¥çš„testå‡½æ•°çš„å‚æ•°é•¿åº¦

```js
 function curry(fn) {
        let length = fn.length;
        return function temp() {
          let arg = [...arguments];
          if (arg.length >= length) {
            return fn(...arg);
          } else {
            return function () {
              return temp(...arg, ...arguments);
            };
          }
        };
      }
      function add(a, b, c) {
        return a + b + c;
      }
      let test = curry(add);
      console.log(test(1)(2, 3));
```

#### 2.ä¸å›ºå®šå‚æ•°

```js
function curry(fn) {
        let arg = [...arguments].slice(1);
        let temp = function temp() {
          arg = [...arg, ...arguments];
          return curry(fn, ...arg);
        };
        temp.toString = function () {
          return fn.apply(null, arg);
        };

        return temp;
      }

      function fn() {
        return [...arguments].reduce((pre, cru) => {
          return pre + cru;
        }, 0);
      }
      let test = curry(fn);
      console.log(test(1)(2, 3)(4).toString());
```

#### 3.å›ºå®šå‚æ•°çš„addå‡½æ•°

```js
function add(x) {
      let sum = x;
      let temp = function (y) {
        sum += y;
        return temp;
      };
      temp.toString = function () {
        return sum;
      };
      return temp;
    }
    let a = add(1)(2)(4);
    console.log(a.toString());
```



#### 4.å›ºå®šå‚æ•°çš„addå‡½æ•°

```js
 function add() {
        let arg = [...arguments];
        let add = function () {
          arg.push(...arguments);
          return add;
        };
        add.valueOf = function () {
          return arg.reduce((pre, cru) => {
            return pre + cru;
          });
        };
        return add;
      }
      console.log(add(1)(2)(3)(4)(5).valueOf());
```



### 10.å®ç°new

```javascript
function news(fn, ...arg) {
        let obj = {};
        obj.__proto__ = fn.prototype;
        fn.apply(obj, arg);
        return obj;
      }

      // ä½¿ç”¨æ–¹æ³•
      function Person(name, age) {
        this.name = name;
        this.age = age;
      }
      let person1 = news(Person, "å¼ ä¸‰", 15);
      console.log(person1);

      let person2 = new Person("æå››", 15);
      console.log(person2);
```



### 11.å®ç°Instanceof

```js
function myInstanceof(left, right) {
        let proto = Object.getPrototypeOf(left),
          prototype = right.prototype;

        while (1) {
          if (!proto) return false;
          if (proto === prototype) return true;

          proto = Object.getPrototypeOf(proto);
        }
      }
      console.log(myInstanceof([1, 3, 4], Array));
      console.log(myInstanceof({}, Array));
      console.log(myInstanceof(new Date(), Object));
      console.log(myInstanceof(2, Array));
```



### 12.æ‰‹å†™promise

#### é“¾å¼è°ƒç”¨åŸç†

æˆ‘é—¨å¸¸å¸¸ç”¨åˆ° new Promise().then().then() ,è¿™å°±æ˜¯é“¾å¼è°ƒç”¨ï¼Œç”¨æ¥è§£å†³å›è°ƒåœ°ç‹±

1ã€ä¸ºäº†è¾¾æˆé“¾å¼ï¼Œ**æˆ‘ä»¬é»˜è®¤åœ¨ç¬¬ä¸€ä¸ªthené‡Œè¿”å›ä¸€ä¸ªpromise**ã€‚è§„å®šäº†ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯**åœ¨thené‡Œé¢è¿”å›ä¸€ä¸ªæ–°çš„promise**,ç§°ä¸ºpromise2ï¼š promise2 = new Promise((resolve, reject)=>{})
â€¢å°†è¿™ä¸ªpromise2è¿”å›çš„å€¼ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªthenä¸­
â€¢å¦‚æœè¿”å›ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œåˆ™å°†æ™®é€šçš„å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ªthenä¸­

2ã€å½“æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªthenä¸­ return äº†ä¸€ä¸ªå‚æ•°ï¼ˆå‚æ•°æœªçŸ¥ï¼Œéœ€åˆ¤æ–­ï¼‰ã€‚è¿™ä¸ªreturnå‡ºæ¥çš„æ–°çš„promiseå°±æ˜¯onFulfilled()æˆ–onRejected()çš„å€¼

**è§„å®šonFulfilled()æˆ–onRejected()çš„å€¼ï¼Œå³ç¬¬ä¸€ä¸ªthenè¿”å›çš„å€¼ï¼Œå«åšxï¼Œåˆ¤æ–­xçš„å‡½æ•°å«åšresolvePromise**

```js
then(onFulfilled,onRejected) {
    // å£°æ˜è¿”å›çš„promise2
    let promise2 = new Promise((resolve, reject)=>{
      if (this.state === 'fulfilled') {
        let x = onFulfilled(this.value);
        resolvePromise(promise2, x, resolve, reject);
      };
      if (this.state === 'rejected') {
        let x = onRejected(this.reason);
        resolvePromise(promise2, x, resolve, reject);
      };
      if (this.state === 'pending') {
        this.onResolvedCallbacks.push(()=>{
          let x = onFulfilled(this.value);
          resolvePromise(promise2, x, resolve, reject);
        })
        this.onRejectedCallbacks.push(()=>{
          let x = onRejected(this.value);
          resolvePromise(promise2, x, resolve, reject);
        })
      }
    });
    // è¿”å›promiseï¼Œå®Œæˆé“¾å¼
    return promise2;
  }
```

è§„å®šäº†ä¸€æ®µä»£ç ï¼Œè®©ä¸åŒçš„promiseä»£ç äº’ç›¸å¥—ç”¨ï¼Œå«åšresolvePromise
â€¢å¦‚æœ x === promise2ï¼Œåˆ™æ˜¯ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œè‡ªå·±ç­‰å¾…è‡ªå·±å®Œæˆï¼Œåˆ™æŠ¥â€œå¾ªç¯å¼•ç”¨â€é”™è¯¯

```js
let p = new Promise(resolve => {
  resolve(0);
});
var p2 = p.then(data => {
  // å¾ªç¯å¼•ç”¨ï¼Œè‡ªå·±ç­‰å¾…è‡ªå·±å®Œæˆï¼Œä¸€è¾ˆå­å®Œä¸æˆ
  return p2;
})

```

1ã€åˆ¤æ–­x

â€¢x ä¸èƒ½æ˜¯null
â€¢x æ˜¯æ™®é€šå€¼ ç›´æ¥resolve(x)
â€¢ x æ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°ï¼ˆåŒ…æ‹¬promiseï¼‰ï¼Œ let then = x.then 2ã€å½“xæ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°ï¼ˆé»˜è®¤promiseï¼‰
â€¢å£°æ˜äº†then
â€¢å¦‚æœå–thenæŠ¥é”™ï¼Œåˆ™èµ°reject()
â€¢å¦‚æœthenæ˜¯ä¸ªå‡½æ•°ï¼Œåˆ™ç”¨callæ‰§è¡Œthenï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thisï¼Œåé¢æ˜¯æˆåŠŸçš„å›è°ƒå’Œå¤±è´¥çš„å›è°ƒ
â€¢å¦‚æœæˆåŠŸçš„å›è°ƒè¿˜æ˜¯pormiseï¼Œå°±é€’å½’ç»§ç»­è§£æ 3ã€æˆåŠŸå’Œå¤±è´¥åªèƒ½è°ƒç”¨ä¸€ä¸ª æ‰€ä»¥è®¾å®šä¸€ä¸ªcalledæ¥é˜²æ­¢å¤šæ¬¡è°ƒç”¨

```js
function resolvePromise(promise2, x, resolve, reject){
  // å¾ªç¯å¼•ç”¨æŠ¥é”™
  if(x === promise2){
    // rejectæŠ¥é”™
    return reject(new TypeError('Chaining cycle detected for promise'));
  }
  // é˜²æ­¢å¤šæ¬¡è°ƒç”¨
  let called;
  // xä¸æ˜¯null ä¸”xæ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°
  if (x != null && (typeof x === 'object' || typeof x === 'function')) {
    try {
      // A+è§„å®šï¼Œå£°æ˜then = xçš„thenæ–¹æ³•
      let then = x.then;
      // å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†
      if (typeof then === 'function') { 
        // å°±è®©thenæ‰§è¡Œ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯this   åé¢æ˜¯æˆåŠŸçš„å›è°ƒ å’Œ å¤±è´¥çš„å›è°ƒ
        then.call(x, y => {
          // æˆåŠŸå’Œå¤±è´¥åªèƒ½è°ƒç”¨ä¸€ä¸ª
          if (called) return;
          called = true;
          // resolveçš„ç»“æœä¾æ—§æ˜¯promise é‚£å°±ç»§ç»­è§£æ
          resolvePromise(promise2, y, resolve, reject);
        }, err => {
          // æˆåŠŸå’Œå¤±è´¥åªèƒ½è°ƒç”¨ä¸€ä¸ª
          if (called) return;
          called = true;
          reject(err);// å¤±è´¥äº†å°±å¤±è´¥äº†
        })
      } else {
        resolve(x); // ç›´æ¥æˆåŠŸå³å¯
      }
    } catch (e) {
      // ä¹Ÿå±äºå¤±è´¥
      if (called) return;
      called = true;
      // å–thenå‡ºé”™äº†é‚£å°±ä¸è¦åœ¨ç»§ç»­æ‰§è¡Œäº†
      reject(e); 
    }
  } else {
    resolve(x);
  }
}

```



#### ä¸å®Œå…¨å®ç°ï¼ˆæ²¡æœ‰å®Œå…¨å®ç°é“¾å¼è°ƒç”¨ï¼‰

```javascript
/*  Promiseæœ‰ä¸‰ä¸ªçŠ¶æ€,åŒ…æ‹¬Pending,resolved,rejected */
      //çŠ¶æ€å®šä¹‰
      const PENDING = "pending";
      const RESOLVED = "resolved";
      const REJECTED = "rejected";

      function MyPromise() {
        //ä¿å­˜åˆå§‹åŒ–çŠ¶æ€
        var self = this;
        //åˆå§‹åŒ–çŠ¶æ€
        this.state = PENDING;
        //ç”¨äºä¿å­˜resolveæˆ–è€…rejectedä¼ å…¥çš„å€¼
        this.value = null;
        //ç”¨äºä¿å­˜resolveçš„å›è°ƒå‡½æ•°
        this.resolvedCallbacks = [];
        //ç”¨äºä¿å­˜rejectçš„å›è°ƒå‡½æ•°
        this.rejectedCallbacks = [];

        //çŠ¶æ€è½¬å˜ä¸ºresolvedæ–¹æ³•
        function resolved(value) {
          if (value instanceof MyPromise) {
            return value.then(resolved, rejected);
          }

          //ä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ºæœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾
          setTimeout(() => {
            //   åªæœ‰çŠ¶æ€pendingæ‰æ”¹å˜
            if (self.state === PENDING) {
              //æ”¹å˜çŠ¶æ€
              self.status = RESOLVED;
              //è®¾ç½®ä¼ å…¥çš„å€¼
              self.value = value;
              //æ‰§è¡Œå›è°ƒå‡½æ•°
              self.resolvedCallbacks.forEach((callback) => {
                callback(back);
              });
            }
          }, 0);
        }

        //çŠ¶æ€è½¬å˜ä¸ºrejectedæ–¹æ³•
        function rejected(value) {
          //ä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ºæœ¬è½®äº‹ä»¶å¾ªç¯çš„æœ«å°¾
          setTimeout(() => {
            //   åªæœ‰çŠ¶æ€pendingæ‰æ”¹å˜
            if (self.state === PENDING) {
              //æ”¹å˜çŠ¶æ€
              self.status = REJECTED;
              //è®¾ç½®ä¼ å…¥çš„å€¼
              self.value = value;
              //æ‰§è¡Œå›è°ƒå‡½æ•°
              self.rejectedCallbacks.forEach((callback) => {
                callback(back);
              });
            }
          }, 0);
        }

        //å°†ä¸¤ä¸ªæ–¹æ³•ä¼ å…¥å‡½æ•°æ‰§è¡Œ
        try {
          fn(resolve, reject);
        } catch (e) {
          //é‡åˆ°é”™è¯¯æ—¶,æ•è·é”™è¯¯,æ‰§è¡Œrejectå‡½æ•°
          reject(e);
        }

        MyPromise.prototype.then = function (onResolved, onRejected) {
          //é¦–å…ˆåˆ¤æ–­ä¸¤ä¸ªå‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ç±»å‹,å› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¯é€‰å‚æ•°
          onResolved =
            typeof onResolved === "function"
              ? onResolved
              : function (value) {
                  return value;
                };
          onRejected =
            typeof onRejected === "function"
              ? onRejected
              : function (error) {
                  throw error;
                };

          //å¦‚æœæ˜¯ç­‰å¾…çŠ¶æ€,åˆ™å°†å‡½æ•°åŠ å…¥å¯¹åº”åˆ—è¡¨ä¸­
          if (this.status === PENDING) {
            this.resolvedCallbacks.push(onResolved);
            this.rejectedCallbacks.push(onRejected);
          }
          if (this.state === RESOLVED) {
            onResolved(this.value);
          }
          if (this.state === REJECTED) {
            onRejected(this.value);
          }
        };
      }
```

#### å®Œå…¨è§„èŒƒå®ç°

```js
class Promise{
  constructor(executor){
    this.state = 'pending';
    this.value = undefined;
    this.reason = undefined;
    this.onResolvedCallbacks = [];
    this.onRejectedCallbacks = [];
    let resolve = value => {
      if (this.state === 'pending') {
        this.state = 'fulfilled';
        this.value = value;
        this.onResolvedCallbacks.forEach(fn=>fn());
      }
    };
    let reject = reason => {
      if (this.state === 'pending') {
        this.state = 'rejected';
        this.reason = reason;
        this.onRejectedCallbacks.forEach(fn=>fn());
      }
    };
    try{
      executor(resolve, reject);
    } catch (err) {
      reject(err);
    }
  }
  then(onFulfilled,onRejected) {
    // onFulfilledå¦‚æœä¸æ˜¯å‡½æ•°ï¼Œå°±å¿½ç•¥onFulfilledï¼Œç›´æ¥è¿”å›value
    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value;
    // onRejectedå¦‚æœä¸æ˜¯å‡½æ•°ï¼Œå°±å¿½ç•¥onRejectedï¼Œç›´æ¥æ‰”å‡ºé”™è¯¯
    onRejected = typeof onRejected === 'function' ? onRejected : err => { throw err };
    let promise2 = new Promise((resolve, reject) => {
      if (this.state === 'fulfilled') {
        // å¼‚æ­¥
        setTimeout(() => {
          try {
            let x = onFulfilled(this.value);
            resolvePromise(promise2, x, resolve, reject);
          } catch (e) {
            reject(e);
          }
        }, 0);
      };
      if (this.state === 'rejected') {
        // å¼‚æ­¥
        setTimeout(() => {
          // å¦‚æœæŠ¥é”™
          try {
            let x = onRejected(this.reason);
            resolvePromise(promise2, x, resolve, reject);
          } catch (e) {
            reject(e);
          }
        }, 0);
      };
      if (this.state === 'pending') {
        this.onResolvedCallbacks.push(() => {
          // å¼‚æ­¥
          setTimeout(() => {
            try {
              let x = onFulfilled(this.value);
              resolvePromise(promise2, x, resolve, reject);
            } catch (e) {
              reject(e);
            }
          }, 0);
        });
        this.onRejectedCallbacks.push(() => {
          // å¼‚æ­¥
          setTimeout(() => {
            try {
              let x = onRejected(this.reason);
              resolvePromise(promise2, x, resolve, reject);
            } catch (e) {
              reject(e);
            }
          }, 0)
        });
      };
    });
    // è¿”å›promiseï¼Œå®Œæˆé“¾å¼
    return promise2;
  }
}

```

#### å…¨éƒ¨æ–¹æ³•å®ç°

```js
class Promise{
  constructor(executor){
    this.state = 'pending';
    this.value = undefined;
    this.reason = undefined;
    this.onResolvedCallbacks = [];
    this.onRejectedCallbacks = [];
    let resolve = value => {
      if (this.state === 'pending') {
        this.state = 'fulfilled';
        this.value = value;
        this.onResolvedCallbacks.forEach(fn=>fn());
      }
    };
    let reject = reason => {
      if (this.state === 'pending') {
        this.state = 'rejected';
        this.reason = reason;
        this.onRejectedCallbacks.forEach(fn=>fn());
      }
    };
    try{
      executor(resolve, reject);
    } catch (err) {
      reject(err);
    }
  }
  then(onFulfilled,onRejected) {
    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value;
    onRejected = typeof onRejected === 'function' ? onRejected : err => { throw err };
    let promise2 = new Promise((resolve, reject) => {
      if (this.state === 'fulfilled') {
        setTimeout(() => {
          try {
            let x = onFulfilled(this.value);
            resolvePromise(promise2, x, resolve, reject);
          } catch (e) {
            reject(e);
          }
        }, 0);
      };
      if (this.state === 'rejected') {
        setTimeout(() => {
          try {
            let x = onRejected(this.reason);
            resolvePromise(promise2, x, resolve, reject);
          } catch (e) {
            reject(e);
          }
        }, 0);
      };
      if (this.state === 'pending') {
        this.onResolvedCallbacks.push(() => {
          setTimeout(() => {
            try {
              let x = onFulfilled(this.value);
              resolvePromise(promise2, x, resolve, reject);
            } catch (e) {
              reject(e);
            }
          }, 0);
        });
        this.onRejectedCallbacks.push(() => {
          setTimeout(() => {
            try {
              let x = onRejected(this.reason);
              resolvePromise(promise2, x, resolve, reject);
            } catch (e) {
              reject(e);
            }
          }, 0)
        });
      };
    });
    return promise2;
  }
  catch(fn){
    return this.then(null,fn);
  }
}
function resolvePromise(promise2, x, resolve, reject){
  if(x === promise2){
    return reject(new TypeError('Chaining cycle detected for promise'));
  }
  let called;
  if (x != null && (typeof x === 'object' || typeof x === 'function')) {
    try {
      let then = x.then;
      if (typeof then === 'function') { 
        then.call(x, y => {
          if(called)return;
          called = true;
          resolvePromise(promise2, y, resolve, reject);
        }, err => {
          if(called)return;
          called = true;
          reject(err);
        })
      } else {
        resolve(x);
      }
    } catch (e) {
      if(called)return;
      called = true;
      reject(e); 
    }
  } else {
    resolve(x);
  }
}
//resolveæ–¹æ³•
Promise.resolve = function(val){
  return new Promise((resolve,reject)=>{
    resolve(val)
  });
}
//rejectæ–¹æ³•
Promise.reject = function(val){
  return new Promise((resolve,reject)=>{
    reject(val)
  });
}
//raceæ–¹æ³• 
Promise.race = function(promises){
  return new Promise((resolve,reject)=>{
    for(let i=0;i<promises.length;i++){
      promises[i].then(resolve,reject)
    };
  })
}
//allæ–¹æ³•(è·å–æ‰€æœ‰çš„promiseï¼Œéƒ½æ‰§è¡Œthenï¼ŒæŠŠç»“æœæ”¾åˆ°æ•°ç»„ï¼Œä¸€èµ·è¿”å›)
Promise.all = function(promises){
  let arr = [];
  let i = 0;
  function processData(index,data){
    arr[index] = data;
    i++;
    if(i == promises.length){
      resolve(arr);
    };
  };
  return new Promise((resolve,reject)=>{
    for(let i=0;i<promises.length;i++){
      promises[i].then(data=>{
        processData(i,data);
      },reject);
    };
  });
}

```



### 13.æ‰‹å†™Reduce

```js
Array.prototype.myReduce = function (cb, initialValue) {
  const array = this//è·å–æ•°ç»„
  let acc = initialValue || array[0]//accç›¸å½“äºpre
  const startIndex = initialValue ? 0 : 1
  for (let i = startIndex; i < array.length; i++) {
    const cur = array[i]
    acc = cb(acc, cur, i, array)
  }
  return acc
}

```



### 14.æ‰‹å†™promisify

æ‰‹åŠ¨å®ç°ä¸€ä¸ªpromisifyå‡½æ•°çš„æ„æ€æ˜¯ï¼šæˆ‘ä»¬æŠŠä¸€ä¸ªå¼‚æ­¥è¯·æ±‚çš„å‡½æ•°ï¼Œå°è£…æˆä¸€ä¸ªå¯ä»¥å…·æœ‰ `then`æ–¹æ³•çš„å‡½æ•°ï¼Œå¹¶ä¸”åœ¨`then`æ–¹æ³•ä¸­è¿”å›å¼‚æ­¥æ–¹æ³•æ‰§è¡Œç»“æœçš„è¿™ä¹ˆä¸€ä¸ªå‡½æ•°

1. å…·æœ‰ then æ–¹æ³•
2. then æ–¹æ³•é‡Œè¿”å›å¼‚æ­¥æ¥å£æ‰§è¡Œç»“æœ

```js
// é¦–å…ˆå®šä¸€ä¸ªéœ€è¦è¿›è¡Œ promisify çš„å‡½æ•°
function asyncFn(a, b, callback) {
        // å¼‚æ­¥æ“ä½œï¼Œä½¿ç”¨ setTimeout æ¨¡æ‹Ÿ
        console.log('å¼‚æ­¥è¯·æ±‚å‚æ•°', a, b)
        setTimeout(function() {
                callback('å¼‚æ­¥è¯·æ±‚ç»“æœ')
        }, 3000)
}

// æˆ‘ä»¬å¸Œæœ›è°ƒç”¨çš„æ–¹å¼æ˜¯
const proxy = promisify(asyncFn)
proxy(11,22).then(res => {
        // æ­¤å¤„è¾“å‡ºå¼‚æ­¥å‡½æ•°æ‰§è¡Œç»“æœ
        console.log(res)
})

// å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œ éœ€è¦é’ˆå¯¹å¼‚æ­¥æ–¹æ³•åšå°è£…ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¥å‚ï¼Œæ—¢éœ€è¦promisifyçš„åŸå¼‚æ­¥æ–¹æ³•
function promisify( asyncFn ) {
        // æ–¹æ³•å†…éƒ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨asyncFnæ–¹æ³•ï¼Œå¹¶ä¼ é€’åŸå§‹å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦è¿”å›ä¸€ä¸ªæ–¹æ³•æ¥æ¥æ”¶å‚æ•°
        return function(...args) { // ç”±äºéœ€è¦æ¥æ”¶å‚æ•°ï¼Œæ‰€ä»¥å‚æ•°æˆ‘ä»¬å¯ä»¥å†™ä¸º...args
                // æˆ‘ä»¬éœ€è¦æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªç»“æœï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ª promiseå®ä¾‹
                return new Promise(resolve => {
                        // asyncFn éœ€è¦æ‰§è¡Œä¸€ä¸ªå›è°ƒï¼Œæ‰€ä»¥å®šä¹‰ä¸€ä¸ªå›è°ƒæ–¹æ³•
                        const callback = function(...args) {
                              resolve(args)
                         }
                        args.push(callback)
                        asyncFn.apply(null, args)
                })
        }
}

```

### 15.ç”¨setTimeoutå®ç°setInterval

setTimeout() ï¼šåœ¨æŒ‡å®šçš„æ¯«ç§’æ•°åè°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚setInterval() ï¼šæŒ‰ç…§æŒ‡å®šçš„å‘¨æœŸï¼ˆä»¥æ¯«ç§’è®¡ï¼‰æ¥è°ƒç”¨å‡½æ•°æˆ–è®¡ç®—è¡¨è¾¾å¼ã€‚æ–¹æ³•ä¼šä¸åœåœ°è°ƒç”¨å‡½æ•°ï¼Œç›´åˆ° clearInterval() è¢«è°ƒç”¨æˆ–çª—å£è¢«å…³é—­ã€‚

ä½¿ç”¨é€’å½’å‡½æ•°ï¼Œä¸æ–­åœ°å»æ‰§è¡ŒsetTimeoutä»è€Œè¾¾åˆ°setIntervalçš„æ•ˆæœ

setInterval çš„ä½œç”¨æ˜¯æ¯éš”ä¸€æ®µæŒ‡å®šæ—¶é—´æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªæ‰§è¡Œä¸æ˜¯çœŸçš„åˆ°äº†æ—¶é—´ç«‹å³æ‰§è¡Œï¼Œå®ƒçœŸæ­£çš„ä½œç”¨æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å°†äº‹ä»¶åŠ å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­å»ï¼Œåªæœ‰å½“å½“å‰çš„æ‰§è¡Œæ ˆä¸ºç©ºçš„æ—¶å€™ï¼Œæ‰èƒ½å»ä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶æ‰§è¡Œã€‚æ‰€ä»¥å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œå°±æ˜¯å½“å‰æ‰§è¡Œæ ˆæ‰§è¡Œçš„æ—¶é—´å¾ˆé•¿ï¼Œå¯¼è‡´äº‹ä»¶é˜Ÿåˆ—é‡Œè¾¹ç§¯ç´¯å¤šä¸ªå®šæ—¶å™¨åŠ å…¥çš„äº‹ä»¶ï¼Œå½“æ‰§è¡Œæ ˆç»“æŸçš„æ—¶å€™ï¼Œè¿™äº›äº‹ä»¶ä¼šä¾æ¬¡æ‰§è¡Œï¼Œå› æ­¤å°±ä¸èƒ½åˆ°é—´éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œçš„æ•ˆæœã€‚

é’ˆå¯¹ setInterval çš„è¿™ä¸ªç¼ºç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ setTimeout é€’å½’è°ƒç”¨æ¥æ¨¡æ‹Ÿ setIntervalï¼Œè¿™æ ·æˆ‘ä»¬å°±ç¡®ä¿äº†åªæœ‰ä¸€ä¸ªäº‹ä»¶ç»“æŸäº†ï¼Œæˆ‘ä»¬æ‰ä¼šè§¦å‘ä¸‹ä¸€ä¸ªå®šæ—¶å™¨äº‹ä»¶ï¼Œè¿™æ ·è§£å†³äº† setInterval çš„é—®é¢˜ã€‚

å®ç°æ€è·¯æ˜¯ä½¿ç”¨é€’å½’å‡½æ•°ï¼Œä¸æ–­åœ°å»æ‰§è¡Œ setTimeout ä»è€Œè¾¾åˆ° setInterval çš„æ•ˆæœ

```js
function mySetInterval(fn, delay){
  function interval(){
    setTimeout(interval, delay);
    fn();
  }
  setTimeout(interval, delay)
}
```

é™åˆ¶è°ƒç”¨æ¬¡æ•°

```js
function mySetInterval(fn, delay,count){
  function interval(){
    if(typeof count==='undefined'||count-->0){
      setTimeout(interval, delay);
      try{
        fn()
      }catch(e){
        count = 0;
        throw e.toString();
      }
    }
  }
  setTimeout(interval, delay)
}
```

### 16.promiseä¸²è¡Œæ‰§è¡Œ

```js
const funcArr = [
    () =>
        new Promise((resolve) => {
            setTimeout(() => resolve(1), 2000);
        }),
    () =>
        new Promise((resolve) => {
            setTimeout(() => resolve(2), 1000);
        }),
    () =>
        new Promise((resolve) => {
            setTimeout(() => resolve(3), 3000);
        }),
];
/**
 * @description: å®ç°Promiseçš„ä¸²è¡Œ
 * @param {*}: æ¥æ”¶ä¸€ä¸ªåŒ…å«å¤šä¸ªè¿”å›Promiseå¯¹è±¡çš„å‡½æ•°çš„æ•°ç»„
 * @return {*}: è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡
 */
function inOrder(arr) {
    const res = []
    return new Promise((resolve,reject) => {
        arr.reduce((pre,cur) => {
            return pre.then(cur).then(data => res.push(data))
        },Promise.resolve()).then(() => resolve(res))       
    })
}

inOrder(funcArr).then(data => console.log(data))

```



### 17.åŸºäºPromiseçš„fetch

```js
const log = console.log;
function maxRequest(url = ``, times = 3) {
  // 1. é—­åŒ…ï¼Œä¿å­˜ç§æœ‰å±æ€§
  function autoRetry (url, times) {
    console.log('times = ', times);
    times--;
    // 2. fetch æœ¬èº«è¿”å›å€¼å°±æ˜¯ Promiseï¼Œä¸éœ€è¦å†æ¬¡ä½¿ç”¨ Promise åŒ…è£¹
    return fetch(url).then(value => {
        if(value.status === 200) {
          console.log(`âœ… OK`, value);
          // 3. æ‰‹åŠ¨è¿”å› Promise çš„ valueï¼Œ æ²¡æœ‰è¿”å›å€¼ é»˜è®¤è¿”å› undefined
          return value;
        } else {
          throw new Error(`âŒ  http code error: ${value.status }`);
        }
      }).catch((err) => {
        console.log(`âŒ  Error`, err);
        if (times < 1) {
          // 4. æ–¹ä¾¿åç»­çš„ thenable å¤„ç† error
          throw new Error('ğŸ’©  over max request times!');
        } else {
          // 5. è¿”å›é€’å½’æ–¹æ³• 
          return autoRetry(url, times);
        }
      });
  }
  // 6. è¿”å›ä¸€ä¸ª Promise çš„ç»“æœ ï¼ˆæˆåŠŸ Promise æˆ–å¤±è´¥ Promiseï¼‰
  return autoRetry(url, times);
}

// error test case
maxRequest(`https://cdn.xgqfrms.xyz/json/badges.js`)
  .then(res => res.json())
  .then(json=> console.log('json =', json))
  .catch(err => console.error(`err =`, err))
  .finally(() => {
      console.log('ğŸ‘»  whatever close loading...');
  });

// sucess test case
maxRequest(`https://cdn.xgqfrms.xyz/json/badges.json`)
  .then(res => res.json())
  .then(json=> console.log('json =', json))
  .catch(err => console.error(`err =`, err))
  .finally(() => {
      console.log('ğŸ‘»  whatever close loading...');
  });
```



------

## æ•°æ®å¤„ç†é¢˜

### 1.å®ç°æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°

```js
dateFormat(new Date('2020-12-01'), 'yyyy/MM/dd') // 2020/12/01
dateFormat(new Date('2020-04-01'), 'yyyy/MM/dd') // 2020/04/01
dateFormat(new Date('2020-04-01'), 'yyyyå¹´MMæœˆddæ—¥') // 2020å¹´04æœˆ01æ—¥

const dateFormat = (dateInput, format)=>{
    var day = dateInput.getDate() 
    var month = dateInput.getMonth() + 1  
    var year = dateInput.getFullYear()   
    format = format.replace(/yyyy/, year)
    format = format.replace(/MM/,month)
    format = format.replace(/dd/,day)
    return format
}
```



### 2.æ•°ç»„æ‰å¹³åŒ–

#### ç®€å•ç‰ˆ

**ï¼ˆ1ï¼‰é€’å½’å®ç°**

æ™®é€šçš„é€’å½’æ€è·¯å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯é€šè¿‡å¾ªç¯é€’å½’çš„æ–¹å¼ï¼Œä¸€é¡¹ä¸€é¡¹åœ°å»éå†ï¼Œå¦‚æœæ¯ä¸€é¡¹è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå°±ç»§ç»­å¾€ä¸‹éå†ï¼Œåˆ©ç”¨é€’å½’ç¨‹åºçš„æ–¹æ³•ï¼Œæ¥å®ç°æ•°ç»„çš„æ¯ä¸€é¡¹çš„è¿æ¥ï¼š

```javascript
let arr = [1, [2, [3, 4, 5]]];
function flatten(arr) {
  let result = [];

  for(let i = 0; i < arr.length; i++) {
    if(Array.isArray(arr[i])) {
      result = result.concat(flatten(arr[i]));
    } else {
      result.push(arr[i]);
    }
  }
  return result;
}
flatten(arr);  //  [1, 2, 3, 4ï¼Œ5]
```

**ï¼ˆ2ï¼‰reduce å‡½æ•°è¿­ä»£**

ä»ä¸Šé¢æ™®é€šçš„é€’å½’å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å°±æ˜¯å¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå…¶å®ä¹Ÿå¯ä»¥ç”¨reduce æ¥å®ç°æ•°ç»„çš„æ‹¼æ¥ï¼Œä»è€Œç®€åŒ–ç¬¬ä¸€ç§æ–¹æ³•çš„ä»£ç ï¼Œæ”¹é€ åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
let arr = [1, [2, [3, 4]]];
function flatten(arr) {
    return arr.reduce(function(prev, next){
        return prev.concat(Array.isArray(next) ? flatten(next) : next)
    }, [])
}
console.log(flatten(arr));//  [1, 2, 3, 4ï¼Œ5]
```

**ï¼ˆ3ï¼‰æ‰©å±•è¿ç®—ç¬¦å®ç°**

è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œé‡‡ç”¨äº†æ‰©å±•è¿ç®—ç¬¦å’Œ some çš„æ–¹æ³•ï¼Œä¸¤è€…å…±åŒä½¿ç”¨ï¼Œè¾¾åˆ°æ•°ç»„æ‰å¹³åŒ–çš„ç›®çš„ï¼š

```javascript
let arr = [1, [2, [3, 4]]];
function flatten(arr) {
    while (arr.some(item => Array.isArray(item))) {
        arr = [].concat(...arr);
    }
    return arr;
}
console.log(flatten(arr)); //  [1, 2, 3, 4ï¼Œ5]
```

**ï¼ˆ4ï¼‰split å’Œ toString**

å¯ä»¥é€šè¿‡ split å’Œ toString ä¸¤ä¸ªæ–¹æ³•æ¥å…±åŒå®ç°æ•°ç»„æ‰å¹³åŒ–ï¼Œç”±äºæ•°ç»„ä¼šé»˜è®¤å¸¦ä¸€ä¸ª toString çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ•°ç»„ç›´æ¥è½¬æ¢æˆé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œç„¶åå†ç”¨ split æ–¹æ³•æŠŠå­—ç¬¦ä¸²é‡æ–°è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š

```javascript
let arr = [1, [2, [3, 4]]];
function flatten(arr) {
    return arr.toString().split(',');
}
console.log(flatten(arr)); //  [1, 2, 3, 4ï¼Œ5]
```

é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥å°†å¤šç»´æ•°ç»„ç›´æ¥è½¬æ¢æˆé€—å·è¿æ¥çš„å­—ç¬¦ä¸²ï¼Œç„¶åå†é‡æ–°åˆ†éš”æˆæ•°ç»„ã€‚

**ï¼ˆ5ï¼‰ES6 ä¸­çš„ flat**

æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥è°ƒç”¨ ES6 ä¸­çš„ flat æ–¹æ³•æ¥å®ç°æ•°ç»„æ‰å¹³åŒ–ã€‚flat æ–¹æ³•çš„è¯­æ³•ï¼š`arr.flat([depth])`

å…¶ä¸­ depth æ˜¯ flat çš„å‚æ•°ï¼Œdepth æ˜¯å¯ä»¥ä¼ é€’æ•°ç»„çš„å±•å¼€æ·±åº¦ï¼ˆé»˜è®¤ä¸å¡«ã€æ•°å€¼æ˜¯ 1ï¼‰ï¼Œå³å±•å¼€ä¸€å±‚æ•°ç»„ã€‚å¦‚æœå±‚æ•°ä¸ç¡®å®šï¼Œå‚æ•°å¯ä»¥ä¼ è¿› Infinityï¼Œä»£è¡¨ä¸è®ºå¤šå°‘å±‚éƒ½è¦å±•å¼€ï¼š

```javascript
let arr = [1, [2, [3, 4]]];
function flatten(arr) {
  return arr.flat(Infinity);
}
console.log(flatten(arr)); //  [1, 2, 3, 4ï¼Œ5]
```

å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªåµŒå¥—äº†ä¸¤å±‚çš„æ•°ç»„ï¼Œé€šè¿‡å°† flat æ–¹æ³•çš„å‚æ•°è®¾ç½®ä¸º Infinityï¼Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚å…¶å®åŒæ ·ä¹Ÿå¯ä»¥è®¾ç½®æˆ 2ï¼Œä¹Ÿèƒ½å®ç°è¿™æ ·çš„æ•ˆæœã€‚åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ•°ç»„çš„åµŒå¥—å±‚æ•°ä¸ç¡®å®šï¼Œæœ€å¥½ç›´æ¥ä½¿ç”¨ Infinityï¼Œå¯ä»¥è¾¾åˆ°æ‰å¹³åŒ–ã€‚

 **ï¼ˆ6ï¼‰æ­£åˆ™å’Œ JSON æ–¹æ³•** åœ¨ç¬¬4ç§æ–¹æ³•ä¸­å·²ç»ä½¿ç”¨ toString æ–¹æ³•ï¼Œå…¶ä¸­ä»ç„¶é‡‡ç”¨äº†å°† JSON.stringify çš„æ–¹æ³•å…ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰å­—ç¬¦ä¸²ä¸­çš„æ•°ç»„çš„æ–¹æ‹¬å·ï¼Œæœ€åå†åˆ©ç”¨ JSON.parse æŠŠå®ƒè½¬æ¢æˆæ•°ç»„ï¼š

```javascript
let arr = [1, [2, [3, [4, 5]]], 6];
function flatten(arr) {
  let str = JSON.stringify(arr);
  str = str.replace(/(\[|\])/g, '');
  str = '[' + str + ']';
  return JSON.parse(str); 
}
console.log(flatten(arr)); //  [1, 2, 3, 4ï¼Œ5]
```

#### é™åˆ¶å±‚æ•°

```js
function flat(arr,num=1){
  return num>0?
    arr.reduce(pre,cur)=>pre.concat(Array.isArray(cur))?flat(cur,num-1):cur),[])
   :arr.slice();
}
```

```js
function flatten(arr,level){
		function walk(arr,currLevel){
			let res=[];
			for(let item of arr){
				if(Array.isArray(item)&&currLevel<level){
					res=res.concat(walk(item,currLevel+1))
				}else{
					res.push(item)
				}
			}
			return res
		}
		return walk(arr,1)
}
```



### 3.æ•°ç»„å»é‡

ç»™å®šæŸæ— åºæ•°ç»„ï¼Œè¦æ±‚å»é™¤æ•°ç»„ä¸­çš„é‡å¤æ•°å­—å¹¶ä¸”è¿”å›æ–°çš„æ— é‡å¤æ•°ç»„ã€‚

ES6æ–¹æ³•ï¼ˆä½¿ç”¨æ•°æ®ç»“æ„é›†åˆï¼‰ï¼š

```javascript
const array = [1, 2, 3, 5, 1, 5, 9, 1, 2, 8];

Array.from(new Set(array)); // [1, 2, 3, 5, 9, 8]
```

ES5æ–¹æ³•ï¼šä½¿ç”¨mapå­˜å‚¨ä¸é‡å¤çš„æ•°å­—

```javascript
const array = [1, 2, 3, 5, 1, 5, 9, 1, 2, 8];

uniqueArray(array); // [1, 2, 3, 5, 9, 8]

function uniqueArray(array) {
  let map = {};
  let res = [];
  for(var i = 0; i < array.length; i++) {
    if(!map.hasOwnProperty([array[i]])) {
      map[array[i]] = 1;
      res.push(array[i]);
    }
  }
  return res;
}
```

### 4.å¤§æ•°è¿ç®—

#### å¤§æ•°ç›¸åŠ 

```js
function add(a,b){
   let a=a.split(''),b=b.split('');
   let sum=[],flag=0;
    while(a.length||b.length){
          let num1=parseInt(a.pop())||0;
          let num2=parseInt(b.pop())||0;
        let temp=num1+num2+flag;
        if(temp>9){
            flag=1
            temp=temp%10
        }else{
            flag=0
        }
        sum.unshift(temp)
  }
  if(flag)sum.unshift(1)  //æœ€åä¸€æ¬¡è¿ç®—æ˜¯å¦éœ€è¦è¿›ä½
    return sum.join('')
}
```

#### å¤§æ•°ç›¸ä¹˜

ä»¥`multiply('11', '99')`ä¸ºä¾‹ï¼Œæ€è·¯å¦‚ä¸‹ï¼š

1.  åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„`res`ç”¨æ¥å­˜æ”¾è®¡ç®—ç»“æœ

2.  åŒé‡forå¾ªç¯ï¼Œä»åå¾€å‰ï¼Œéå†str1å’Œstr2ï¼Œå°†

    ```
    str1[i]*str2[j]+res[i+j]
    ```

    çš„ç»“æœå­˜å‚¨åˆ°resä¸­ã€‚

    -   ä¸€æ¬¡å¾ªç¯åï¼Œres = [empty, 9,9]
    -   äºŒæ¬¡å¾ªç¯åï¼Œres = [9, 18,9]

3.  ä»åå¾€å‰éå†res

    -   `res[index - 1] += parseInt(res[index] / 10)`ï¼Œreså½“å‰é¡¹å–æ•´å’Œreså‰ä¸€é¡¹ç›¸åŠ ï¼ˆå®Œæˆ>10è¿›ä¸€çš„æ“ä½œï¼‰
    -   `res[index] %= 10`ï¼Œreså½“å‰é¡¹å–ä½™

```js

function multiply(str1, str2) {
  if (str1 == '0' || str2 == '0') return '0'
  let res = [],
    i = str1.length - 1,
    j = str2.length - 1;
  for (; i >= 0; i--) {
    let n1 = str1[i] - '0'
    j = str2.length - 1
    for (; j >= 0; j--) {
      let n2 = str2[j] - '0'
      res[i + j] = res[i + j] || 0
      res[i + j] += n1 * n2
    }
  }
  let index = res.length - 1
  while (index >= 1) {
    res[index - 1] += parseInt(res[index] / 10)
    res[index] %= 10
    index--
  }
  return res.join('')
}
var num1 = '546212878237823';
var num2 = '42362078923598';
console.log(multiply(num1, num2))
```



### 5.æ•°å­—åƒåˆ†ä½é€—å·éš”å¼€

ç®€å•å†™æ³•

```js
let number =123456789
function formatNum(number){
  let str=''
  let arr=number.toString().split('')
  let length=arr.length
  while(length>3){
  str=`,${arr.splice(-3).join('')}`+str
  length=arr.length
  }
  return arr.join('')+str
}
console.log(formatNum(number))
```

è€ƒè™‘å°æ•°

```js
function formatNum(number) {
    var arr = (number + '').split('.');
    var int = arr[0].split('');
    var fraction = arr[1] || '';
    var r = "";
    var len = int.length;
    int.reverse().forEach(function (v, i) {
        if (i !== 0 && i % 3 === 0) {
            r = v + "," + r;
        } else {
            r = v + r;
        }
    })
    return r + (!!fraction ? "." + fraction : '');
}
//!!ç›¸å½“äºå°†è½¬æ¢æˆå¸ƒå°”ç±»å‹
```



è€ƒè™‘è´Ÿæ•°

```js
function formatNum(num) {
    let numPrefix = ''
    let numArr = ''
    let numDist = ''

    // å¤„ç†è´Ÿæ•°æƒ…å†µ
    if (num < 0) {
      numPrefix = '-'
      numArr = String(num).slice(1).split('').reverse()
    } else {
      numArr = String(num).split('').reverse()
    }

    for (let i = 0; i < numArr.length; i++) {
      numDist += numArr[i]
      if ((i + 1) % 3 === 0 && (i + 1) < numArr.length) {
        numDist += ','
      }
    }

    return numPrefix + numDist.split('').reverse().join('')
  }
```

æ­£åˆ™

```js
    let num = '12345678'
    let reg = /(?=\B(\d{3})+$)/g
    console.log(num.replace(reg,",")) //12,345,678
```



### 6.è§£æURL Paramsä¸ºå¯¹è±¡

```js
let url = 'http://www.domain.com/?user=anonymous&id=123&id=456&city=%E5%8C%97%E4%BA%AC&enabled';
parseParam(url)
/* ç»“æœ
{ user: 'anonymous',
  id: [ 123, 456 ], // é‡å¤å‡ºç°çš„ key è¦ç»„è£…æˆæ•°ç»„ï¼Œèƒ½è¢«è½¬æˆæ•°å­—çš„å°±è½¬æˆæ•°å­—ç±»å‹
  city: 'åŒ—äº¬', // ä¸­æ–‡éœ€è§£ç 
  enabled: true, // æœªæŒ‡å®šå€¼å¾— key çº¦å®šä¸º true
}
*/
function parseParam(url) {
  const paramsStr = /.+\?(.+)$/.exec(url)[1]; // å°† ? åé¢çš„å­—ç¬¦ä¸²å–å‡ºæ¥
  const paramsArr = paramsStr.split('&'); // å°†å­—ç¬¦ä¸²ä»¥ & åˆ†å‰²åå­˜åˆ°æ•°ç»„ä¸­
  let paramsObj = {};
  // å°† params å­˜åˆ°å¯¹è±¡ä¸­
  paramsArr.forEach(param => {
    if (/=/.test(param)) { // å¤„ç†æœ‰ value çš„å‚æ•°
      let [key, val] = param.split('='); // åˆ†å‰² key å’Œ value
      val = decodeURIComponent(val); // è§£ç 
      val = /^\d+$/.test(val) ? parseFloat(val) : val; // åˆ¤æ–­æ˜¯å¦è½¬ä¸ºæ•°å­—
      if (paramsObj.hasOwnProperty(key)) { // å¦‚æœå¯¹è±¡æœ‰ keyï¼Œåˆ™æ·»åŠ ä¸€ä¸ªå€¼
        paramsObj[key] = [].concat(paramsObj[key], val);
      } else { // å¦‚æœå¯¹è±¡æ²¡æœ‰è¿™ä¸ª keyï¼Œåˆ›å»º key å¹¶è®¾ç½®å€¼
        paramsObj[key] = val;
      }
    } else { // å¤„ç†æ²¡æœ‰ value çš„å‚æ•°
      paramsObj[param] = true;
    }
  })
  return paramsObj;
}

```



### 7.å­—ç¬¦ä¸²å’Œé©¼å³°å¼è½¬æ¢

#### å­—ç¬¦ä¸²è½¬é©¼å³°

##### æ•°ç»„æ³•

```js
//ç©ºæ ¼å¼
let a='hello world'
var b=a.split(' ').map(item=>{
    return item[0].toUpperCase()+item.substr(1,item.length)
}).join('')
console.log(b)

//æ¨ªçº¿å¼
let str='hello-world'
function getCamelCase(str) {
    let arr = str.split('-');
    return arr.map((item, index) => {
        if (index === 0) {
            return item;
        } else {
           return item.chartAt(0).toUpperCase() + item.slice(1); 
        }
    }).join('');
}
console.log(getCamelCase(str))
```

##### æ­£åˆ™æ³•

```js
let a='hello world'
let b = a.replace((/\s\w/g),function(v){
	return v.substring(1).toUpperCase()
})
console.log(b)

let a='hello-world'
let b = a.replace((/-\w/g),function(v){
	return v.substring(1).toUpperCase()
})
console.log(b)
```

#### é©¼å³°è½¬å­—ç¬¦ä¸²

##### æ•°ç»„æ³•

```js
//æ¨ªçº¿å¼
const str = 'helloWorld';
function getKebabCase(str) {
    let arr = str.split('');
    let result = arr.map((item) => {
        if (item.toUpperCase() === item) {
            return '-' + item.toLowerCase();
        } else {
            return item;
        }
    }).join('');
    return result;
}
console.log(getKebabCase(str));
```

```js
const str = 'helloWorld';
function getKebabCase(prev, cur, index, array) {
    if (/[A-Z]/.test(cur)) {
        cur = cur.toLowerCase();
        if (index === 0) {
            return prev + cur;
        } else {
            return prev + '-' + cur;
        }
    } else {
        return prev + cur;
    }
}

function toKebabCase(arr) {
    if (typeof arr === 'string') {
        arr = arr.split('');
    }
    return arr.reduce(getKebabCase, '');
}

let test1 = toKebabCase(str); 
let test2 = [].reduce.call(st, getKebabCase, '');  
```



##### æ­£åˆ™æ³•

```js
const str = 'helloWorld';
function getKebabCase(str) {
    let temp = str.replace(/[A-Z]/g, function(i) {
        return '-' + i.toLowerCase();
    })
    if (temp.slice(0,1) === '-') {
        temp = temp.slice(1);   //å¦‚æœé¦–å­—æ¯æ˜¯å¤§å†™ï¼Œæ‰§è¡Œreplaceæ—¶ä¼šå¤šä¸€ä¸ª-ï¼Œéœ€è¦å»æ‰
    }
    return temp;
}
console.log(getKebabCase(str));
```



### 8.Jså¯¹è±¡è½¬æ ‘å½¢ç»“æ„

```js
// è½¬æ¢å‰ï¼š
source = [{
            id: 1,
            pid: 0,
            name: 'body'
          }, {
            id: 2,
            pid: 1,
            name: 'title'
          }, {
            id: 3,
            pid: 2,
            name: 'div'
          }]
// è½¬æ¢ä¸º: 
tree = [{
          id: 1,
          pid: 0,
          name: 'body',
          children: [{
            id: 2,
            pid: 1,
            name: 'title',
            children: [{
              id: 3,
              pid: 2,
              name: 'div'
            }]
          }]
        }]

```

```js
source = [{
            id: 1,
            pid: 0,
            name: 'body'
          }, {
            id: 2,
            pid: 1,
            name: 'title'
          }, {
            id: 3,
            pid: 2,
            name: 'div'
          }]
//
function treeing (arr) {
  let tree = []
  const map = {}
  for (let item of arr) {
    // ä¸€ä¸ªæ–°çš„å¸¦childrençš„ç»“æ„
    let newItem = map[item.id] = {
      ...item,
      children: []
    }
    if (map[item.pid]) { // çˆ¶èŠ‚ç‚¹å·²å­˜è¿›mapåˆ™åœ¨çˆ¶èŠ‚ç‚¹çš„childrenæ·»åŠ æ–°å…ƒç´ 
      let parent = map[item.pid]
      parent.children.push(newItem)
    } else { // æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œåœ¨æ ¹èŠ‚ç‚¹æ·»åŠ çˆ¶èŠ‚ç‚¹
      tree.push(newItem)
    }
  }
  return tree
}
//
function toTree(data) {
                let result = []
                if(!Array.isArray(data)) {
                    return result
                }
                data.forEach(item => {
                    delete item.children;
                });
                let map = {};
                data.forEach(item => {
                    map[item.id] = item;
                });
                data.forEach(item => {
                    let parent = map[item.pid];
                    if(parent) {
                        (parent.children || (parent.children = [])).push(item);
                    } else {
                        result.push(item);
                    }
                });
                return result;
            }

console.log(treeing(source))
```

### 9.å­—ç¬¦ä¸²å»é‡å’Œåè½¬

å­—ç¬¦ä¸²å»é‡

```js
let str = '11223344aabbcc'
function strSeparate(s) {
    return [...new Set([...s])].join('');
    // or return [...new Set(s.split(''))].join('')
}
console.log(strSeparate(str))

let str = '11223344aabbcc'
function strSeparate(s) {
    // ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼Œå­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„
    s = [...str];
    let arr = [];
    for(let i = 0; i < s.length; i++) {
        if(arr.indexOf(s[i]) == -1) {
            arr.push(s[i])
        }
    }
    return arr.join('');
}
console.log(strSeparate(str))
```



### 10.æ•°å­—åè½¬

```js
var reverse = function(x) {
    let res = 0;
    while(x){
        res = res * 10 + x % 10;
        if(res > Math.pow(2, 31) - 1 || res < Math.pow(-2, 31)) return 0;
        x = ~~(x / 10);
    }
    return res;
};

```

```js
var reverse = function (x) {
    let y = parseInt(x.toString().split("").reverse().join(""));
    if (x < 0)
        y = - y;
    return y > 2147483647 || y < -2147483648 ? 0 : y;
};

```



### 11.è®¡ç®—ç›®å½•æ ‘çš„æ·±åº¦

å¾—å‡ºdepthå³ä¸ºæ ‘çš„é«˜åº¦å¾—å‡ºdepthå³ä¸ºæ ‘

å®šä¹‰å˜é‡depthä¸º0

å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„temp,ç„¶åéå†treeï¼Œå¦‚æœtreeæœ‰childrenï¼Œå°±pushåˆ°tempé‡Œé¢

å¼€å§‹whileå¾ªç¯ï¼Œå¦‚æœtempé•¿åº¦ä¸ä¸º0ï¼Œdepth++ï¼›å¦‚æœtempé•¿åº¦ä¸º0ï¼Œåœæ­¢

å¾—å‡ºdepthå³ä¸ºæ ‘çš„é«˜åº¦

å¾—å‡ºdepthå³ä¸ºæ ‘çš„é«˜åº¦å¾—å‡ºdepthå³ä¸ºæ ‘çš„é«˜åº¦å¾—å‡ºdepthå³ä¸ºæ ‘çš„é«˜åº¦

```js
const tree = {
  name: 'root',
  children: [
    { name: 'å¶å­1-1' },
    { name: 'å¶å­1-2' },
    {
      name: 'å¶å­2-1',
      children: [{
        name: 'å¶å­3-1',
        children: [{
          name: 'å¶å­4-1'
        }]
      }]
    }
  ]
}
 
function getDepth(tree) {
  let depth = 0
 
  if (tree) {
    let arr = [tree]
    let temp = arr
    while (temp.length) {
      arr = temp
      temp = []
      for (let i = 0; i < arr.length; i++) {
        if (arr[i].children && arr[i].children.length) {
          for (let j = 0; j < arr[i].children.length; j++) {
            temp.push(arr[i].children[j])
          }
        }
      }
      depth++
    }
  }
  return depth
}console.log(getDepth(tree)); //è¾“å‡º4
```

### 12.æ ‘å½¢ç»“æ„è·å–è·¯å¾„å

```js
const treeData = [
  {
    name: "root",
    children: [
      { name: "src", children: [{ name: "index.html" }] },
      { name: "public", children: [] },
    ],
  },
];

const RecursiveTree = (data) => {
  data.map((item) => {
    console.log(item.name);
    if (item.children) {
      RecursiveTree(item.children);
    }
  });
};

RecursiveTree(treeData);
```

### 13.æ•°ç»„è½¬åŒ–æˆæ ‘å½¢ç»“æ„

é€’å½’å½¢å¼

```js
  const arr = [
  {id:"01", name: "å¼ å¤§å¤§", pid:"", job: "é¡¹ç›®ç»ç†"},
  {id:"02", name: "å°äº®", pid:"01", job: "äº§å“leader"},
  {id:"03", name: "å°ç¾", pid:"01", job: "UIleader"},
  {id:"04", name: "è€é©¬", pid:"01", job: "æŠ€æœ¯leader"},
  {id:"05", name: "è€ç‹", pid:"01", job: "æµ‹è¯•leader"},
  {id:"06", name: "è€æ", pid:"01", job: "è¿ç»´leader"},
  {id:"07", name: "å°ä¸½", pid:"02", job: "äº§å“ç»ç†"},
  {id:"08", name: "å¤§å…‰", pid:"02", job: "äº§å“ç»ç†"},
  {id:"09", name: "å°é«˜", pid:"03", job: "UIè®¾è®¡å¸ˆ"},
  {id:"10", name: "å°åˆ˜", pid:"04", job: "å‰ç«¯å·¥ç¨‹å¸ˆ"},
  {id:"11", name: "å°å", pid:"04", job: "åç«¯å·¥ç¨‹å¸ˆ"},
  {id:"12", name: "å°æ", pid:"04", job: "åç«¯å·¥ç¨‹å¸ˆ"},
  {id:"13", name: "å°èµµ", pid:"05", job: "æµ‹è¯•å·¥ç¨‹å¸ˆ"},
  {id:"14", name: "å°å¼º", pid:"05", job: "æµ‹è¯•å·¥ç¨‹å¸ˆ"},
  {id:"15", name: "å°æ¶›", pid:"06", job: "è¿ç»´å·¥ç¨‹å¸ˆ"}
]
function toTree(list,parId){
	let len = list.length
	function loop(parId){
		let res = [];
		for(let i = 0; i < len; i++){
			let item = list[i]
			if(item.pid === parId){
				item.children = loop(item.id)
				res.push(item)
			}
		}
		return res
	}
	return loop(parId)
}

let result = toTree(arr,'')
console.log(result);

```

éé€’å½’å½¢å¼

```js
  const arr = [
    { 'id': '29', 'pid': '', 'name': 'æ€»è£åŠ' },
    { 'id': '2c', 'pid': '', 'name': 'è´¢åŠ¡éƒ¨' },
    { 'id': '2d', 'pid': '2c', 'name': 'è´¢åŠ¡æ ¸ç®—éƒ¨' },
    { 'id': '2f', 'pid': '2c', 'name': 'è–ªèµ„ç®¡ç†éƒ¨' },
    { 'id': 'd2', 'pid': '', 'name': 'æŠ€æœ¯éƒ¨' },
    { 'id': 'd3', 'pid': 'd2', 'name': 'Javaç ”å‘éƒ¨' }
  ]

  function tranListToTreeData(list) {
    // 1. å®šä¹‰ä¸¤ä¸ªä¸­é—´å˜é‡
    const treeList = [],  // æœ€ç»ˆè¦äº§å‡ºçš„æ ‘çŠ¶æ•°æ®çš„æ•°ç»„
      map = {}        // å­˜å‚¨æ˜ å°„å…³ç³»


    // 2. å»ºç«‹ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå¹¶ç»™æ¯ä¸ªå…ƒç´ è¡¥å……childrenå±æ€§.
    // æ˜ å°„å…³ç³»: ç›®çš„æ˜¯è®©æˆ‘ä»¬èƒ½é€šè¿‡idå¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„å…ƒç´ 
    // è¡¥å……childrenï¼šè®©åè¾¹çš„è®¡ç®—æ›´æ–¹ä¾¿
    list.forEach(item => {
      if (!item.children) {
        item.children = []
      }
      map[item.id] = item
    })
    //  {
    //    "29": { 'id': '29', 'pid': '',     'name': 'æ€»è£åŠ', children:[] },
    //    '2c': { 'id': '2c', 'pid': '',     'name': 'è´¢åŠ¡éƒ¨', children:[] },
    //    '2d': { 'id': '2d', 'pid': '2c', 'name': 'è´¢åŠ¡æ ¸ç®—éƒ¨', children:[]},
    //    '2f': { 'id': '2f', 'pid': '2c', 'name': 'è–ªèµ„ç®¡ç†éƒ¨', children:[]},
    //    'd2': { 'id': 'd2', 'pid': '',     'name': 'æŠ€æœ¯éƒ¨', children:[]},
    //    'd3': { 'id': 'd3', 'pid': 'd2', 'name': 'Javaç ”å‘éƒ¨', children:[]}
    //  }

    // 3. å¾ªç¯
    list.forEach(item => {
      // å¯¹äºæ¯ä¸€ä¸ªå…ƒç´ æ¥è¯´ï¼Œå…ˆæ‰¾å®ƒçš„ä¸Šçº§
      //    å¦‚æœèƒ½æ‰¾åˆ°ï¼Œè¯´æ˜å®ƒæœ‰ä¸Šçº§ï¼Œåˆ™è¦æŠŠå®ƒæ·»åŠ åˆ°ä¸Šçº§çš„childrenä¸­å»
      //    å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¯´æ˜å®ƒæ²¡æœ‰ä¸Šçº§ï¼Œç›´æ¥æ·»åŠ åˆ° tree3List
      const parent = map[item.pid]
      if (parent) {
        parent.children.push(item)
      } else {
        treeList.push(item)
      }
    })
    // 4. è¿”å›å‡ºå»
    return treeList
  }

  const treeList = tranListToTreeData(arr)
  console.log(treeList);
```



### 14.å¯¹è±¡æ‰å¹³åŒ–

#### 1.å¸¦æ•°ç»„çš„

è¾“å…¥

```js
{
    a: 'a',
    b: [1, { c: true }, [3]],
    d: { e: undefined, f: 3 },
    g: null,
}
```

è¾“å‡º

```js
{
    a: "a",
    b[0]: 1,
    b[1].c: true,
    b[2][0]: 3,
    d.f: 3
    // nullå’Œundefinedç›´æ¥èˆå»
}
```



```js
var myObj={
	a: 'a',
		b: [1, { c: true }, [3]],
			d: { e: undefined, f: 3 },
	g: null,
}

function treeToObj(myObj) {
	function getObj(myObj, str, toObj) {
		const level = Object.keys(myObj)
		let levelStr = str.slice()
		if (levelStr != '') {
			levelStr = levelStr + '.'
		}
		for (key of level) {
			if (myObj[key]) {
				if (typeof (myObj[key]) === 'object') {
					getObj(myObj[key], levelStr + key, toObj)
				} else {
					toObj[levelStr + key] = myObj[key]
				}
			}
		}
		return toObj
	}
	return getObj(myObj,'',{})
}

console.log(treeToObj(myObj))
```

```js
var myObj = {
	a: 'a',
	b: [1, { c: true }, [3]],
	d: { e: undefined, f: 3 },
	g: null,
}

function treeToObj(myObj) {
	const res = {}
	function toObj(obj, str = null) {
		for (let key in obj) {
			if (typeof obj[key] === "number" || typeof obj[key] === "string" || typeof obj[key] === "boolean") {
				if (str === null) {
					res[key] = obj[key]
				} else if (Array.isArray(obj)) {
					res[str + '[' + key + ']'] = obj[key]
				} else {
					res[str + '.' + key] = obj[key]
				}
			} else if (Array.isArray(obj[key])) {
				if (str === null) {
					toObj(obj[key], key)
				} else if (Array.isArray(obj)) {
					toObj(obj[key], str + '[' + key + ']')
				} else {
					toObj(obj[key], str + '.' + key)
				}
			} else if (typeof obj[key] === 'object') {
				if (str === null) {
					toObj(obj[key], key)
				} else if (Array.isArray(obj)) {
					toObj(obj[key], str + '[' + key + ']')
				} else {
					toObj(obj[key], str + '.' + key)
				}
			}
		}
		return res;
	}
	return  toObj(myObj,'')
}
console.log(treeToObj(myObj))
```

#### 2.çº¯å¯¹è±¡

```js
var entry = {
  a: {
    b: {
      c: {
        dd: 'abcdd'
      }
    },
    d: {
      xx: 'adxx'
    },
    e: 'ae'
  }
}

// è¦æ±‚è½¬æ¢æˆå¦‚ä¸‹å¯¹è±¡
var output = {
  'a.b.c.dd': 'abcdd',
  'a.d.xx': 'adxx',
  'a.e': 'ae'
}
```



```js
var entry = {
  a: {
    b: {
      c: {
        dd: 'abcdd'
      }
    },
    d: {
      xx: 'adxx'
    },
    e: 'ae'
  }
}
function flatObj(obj,parentKey="",result={}){
	for(const key in obj){
		if(obj.hasOwnProperty(key)){
			let keyName=`${parentKey}${key}`
			if(typeof obj[key]==='object'){
				flatObj(obj[key],keyName+".",result)
			}else{
				result[keyName]=obj[key]
			}
		}
	}
	return result
}
console.log(flatObj(entry))
```



### 15.æ ¹æ®è¡¨è¾¾å¼è®¡ç®—å­—æ¯æ•°é‡

**æè¿°**ï¼šè¾“å…¥ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦ä¸²æ±‚å‡ºæ¯ä¸ªå­—æ¯çš„æ•°é‡å¹¶è¿”å›ç»“æœå¯¹è±¡ã€‚ï¼ˆæ•°å­—ä¸º1æ—¶å¯çœç•¥ï¼‰
**ç¤ºä¾‹ä¸€**ï¼šè¾“å…¥ï¼šA3B2ï¼Œè¾“å‡ºï¼š{"A": 3, "B": 2}
**ç¤ºä¾‹äºŒ**ï¼šè¾“å…¥ï¼šA(A(A2B)2)3C2ï¼Œè¾“å‡ºï¼š{"A": 16, "B": 6, "C": 2}

```js

var countOfAtoms = function(formula) {
    //è®°å½•å„ä¸ªåŸå­çš„å€¼
    let dict = {}
    //æ ˆä¸­åˆå§‹æ•°å­—ã€‚ç”¨äºè¡¨ç¤ºå•ä¸ªåŸå­çš„æ•°å­—æƒ…å†µ
    let stack = [1]
    //åŸå­å
    let str = ''
    //æš‚ä¸”è®°å½•çš„åŸå­æ•°å­—æƒ…å†µï¼Œå‹å…¥æ ˆæˆ–è€…æ¶ˆè€—åè¦é‡ç½®ã€‚
    let count = 1;
    //ä»åå¾€å‰éå†ã€‚
    for(let i = formula.length - 1; i >= 0; i-- ){
        const value = formula[i];
        //å¦‚æœæ˜¯æ•°å­—ã€‚åˆ™è®°å½•
        if(!isNaN(value)){
            if(count === 1){
                count = value
            }else{
                count = parseInt(value + count)
            }
        };
        //å¦‚æœæ˜¯å°å†™å­—æ¯ï¼Œåˆ™è®°å½•
        if(value >= 'a' && value <= 'z'){
            str = str + value;
        }
        //å¦‚æœæ˜¯å³æ‹¬å·ï¼Œåˆ™å°†è®°å½•çš„æ•°å­—å’Œæ ˆé¡¶éƒ¨æ•°å­—ç›¸ä¹˜å¹¶è¾“å‡º
        if(value === ')'){
            stack.push(stack[stack.length - 1] * count);
            count = 1;
        }
        //å¦‚æœæ˜¯å·¦æ‹¬å·ï¼Œåˆ™å‡ºæ ˆ
        if(value === '('){
            stack.pop();
        }
        //å¦‚æœæ˜¯å¤§å†™å­—æ¯ï¼Œåˆ™å°†æ ˆé¡¶çš„å€¼èµ‹å€¼ç»™è¯¥åŸå­ã€‚å¦‚æœå­—å…¸é‡Œæœ‰è¿™ä¸ªåŸå­ï¼Œåˆ™ç´¯åŠ ã€‚é‡ç½®ä¸´æ—¶è®°å½•çš„æ•°å­—å’ŒåŸå­å€¼
        if(value >= 'A' && value <= 'Z'){
            let atomsValue = count * stack[stack.length-1];
           
            str = value + str;
            if(dict[str] === undefined){
                dict[str] = atomsValue;
            }else{
                dict[str] = dict[str] + atomsValue
            }
            count = 1;
            str = '';
        }
    }
    //æŒ‰ç…§å­—å…¸æ’åº
    let newkey = Object.keys(dict).sort();
    var result = {};//åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç”¨äºå­˜æ”¾æ’å¥½åºçš„é”®å€¼å¯¹
    for (var i = 0; i < newkey.length; i++) {//éå†newkeyæ•°ç»„
        result[newkey[i]] = dict[newkey[i]];//å‘æ–°åˆ›å»ºçš„å¯¹è±¡ä¸­æŒ‰ç…§æ’å¥½çš„é¡ºåºä¾æ¬¡å¢åŠ é”®å€¼å¯¹
    }
    //æŒ‰ç…§è¦æ±‚çš„æ ¼å¼è¾“å‡ºã€‚
    let resultString = ''
    for(var key in result){
        resultString = resultString + key;
        if(result[key] > 1){
            resultString = resultString + result[key];
        }
    }
    return resultString
};
```

ç±»ä¼¼äº[726. åŸå­çš„æ•°é‡](https://leetcode-cn.com/problems/number-of-atoms/)

### 16.å¯¹è±¡æ ‘éå†

```js
const tree = {
	name: 'root',
	children: [
		{
			name: 'c1',
			children: [
				{
						name: 'c11',
					children: []		
					},
					{
						name: 'c12',
					children: []		
				}
			]
		},
		{
			name: 'c2',
			children: [
				{
						name: 'c21',
					children: []		
					},
					{
						name: 'c22',
					children: []		
				}
			]
		}
	]
}

// æ·±åº¦ä¼˜å…ˆçš„æ–¹å¼éå† æ‰“å° name
// ['root', 'c1','c11', 'c12', 'c2', 'c21', 'c22']

```

```js
function solve(root) {
            let stack = [],
                result = [];
            if(!root) return [];
            stack.push(root)
            while(stack.length) {
                let node = stack.pop()
                if(node == null ) continue
                result.push(node.name)
                for(let i = node.children.length-1; i >= 0; i--) {
                    // è¿™é‡Œå°±æ˜¯é¢è¯•çš„é‡ç‚¹,åº”è¯¥ä»åé¢çš„èŠ‚ç‚¹å‹å…¥æ ˆä¸­
                    stack.push(node.children[i])
                }
            }
            return result
        }

```

### 17.æ‰‹å†™JSON.stringifyå’ŒJSON.parse

1.JSON.stringify
JSON.stringify() æ–¹æ³•å°†ä¸€ä¸ª JavaScript å¯¹è±¡æˆ–å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¦‚æœæŒ‡å®šäº†ä¸€ä¸ª replacer å‡½æ•°ï¼Œåˆ™å¯ä»¥é€‰æ‹©æ€§åœ°æ›¿æ¢å€¼ï¼Œæˆ–è€…æŒ‡å®šçš„ replacer æ˜¯æ•°ç»„ï¼Œåˆ™å¯é€‰æ‹©æ€§åœ°ä»…åŒ…å«æ•°ç»„æŒ‡å®šçš„å±æ€§ã€‚

JSON.stringify(value[, replacer [, space]])

Boolean | Number| String ç±»å‹ä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”çš„åŸå§‹å€¼ã€‚
undefinedã€ä»»æ„å‡½æ•°ä»¥åŠsymbolï¼Œä¼šè¢«å¿½ç•¥ï¼ˆå‡ºç°åœ¨éæ•°ç»„å¯¹è±¡çš„å±æ€§å€¼ä¸­æ—¶ï¼‰ï¼Œæˆ–è€…è¢«è½¬æ¢æˆ nullï¼ˆå‡ºç°åœ¨æ•°ç»„ä¸­æ—¶ï¼‰ã€‚
ä¸å¯æšä¸¾çš„å±æ€§ä¼šè¢«å¿½ç•¥ã€‚
å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§å€¼é€šè¿‡æŸç§é—´æ¥çš„æ–¹å¼æŒ‡å›è¯¥å¯¹è±¡æœ¬èº«ï¼Œå³å¾ªç¯å¼•ç”¨ï¼Œå±æ€§ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚
2.JSON.parse
JSON.parse() æ–¹æ³•ç”¨æ¥è§£æJSONå­—ç¬¦ä¸²ï¼Œæ„é€ ç”±å­—ç¬¦ä¸²æè¿°çš„JavaScriptå€¼æˆ–å¯¹è±¡ã€‚æä¾›å¯é€‰çš„ reviver å‡½æ•°ç”¨ä»¥åœ¨è¿”å›ä¹‹å‰å¯¹æ‰€å¾—åˆ°çš„å¯¹è±¡æ‰§è¡Œå˜æ¢(æ“ä½œ)ã€‚

JSON.parse(text[, reviver])

ç”¨æ¥è§£æJSONå­—ç¬¦ä¸²ï¼Œæ„é€ ç”±å­—ç¬¦ä¸²æè¿°çš„JavaScriptå€¼æˆ–å¯¹è±¡ã€‚æä¾›å¯é€‰çš„reviverå‡½æ•°ç”¨ä»¥åœ¨è¿”å›ä¹‹å‰å¯¹æ‰€å¾—åˆ°çš„å¯¹è±¡æ‰§è¡Œå˜æ¢(æ“ä½œ)ã€‚

#### JSON.stringify

```js
function jsonStringify (obj) {
  let type = typeof obj;
  if (type !== "object" || type === null) {
    if (/string|undefined|function/.test(type)) {
      obj = '"' + obj + '"';
    }
    return String(obj);
  } else {
    let json = []
    arr = (obj && obj.constructor === Array);
    for (let k in obj) {
      let v = obj[k];
      let type = typeof v;
      if (/string|undefined|function/.test(type)) {
        v = '"' + v + '"';
      } else if (type === "object") {
        v = jsonStringify(v);
      }
      json.push((arr ? "" : '"' + k + '":') + String(v));
    }
    return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}")
  }
}
jsonStringify({ x: 5 })
// "{"x":5}"
jsonStringify([1, "false", false])
// "[1,"false",false]"
jsonStringify({ b: undefined })
// "{"b":"undefined"}"
```



------

## åœºæ™¯é¢˜

### 1.å¾ªç¯æ‰“å°é»„ç»¿è“

#### æ™®é€šé€’å½’

```js
const task = (timer, light, callback) => {
    setTimeout(() => {
        if (light === 'red') {
            red()
        }
        else if (light === 'green') {
            green()
        }
        else if (light === 'yellow') {
            yellow()
        }
        callback()
    }, timer)
}
const step = () => {
    task(3000, 'red', () => {
        task(2000, 'green', () => {
            task(1000, 'yellow', step)
        })
    })
}
step()
```

#### ä½¿ç”¨promiseå®ç°

```js
const task = (timer, light) => 
    new Promise((resolve, reject) => {
        setTimeout(() => {
            if (light === 'red') {
                red()
            }
            else if (light === 'green') {
                green()
            }
            else if (light === 'yellow') {
                yellow()
            }
            resolve()
        }, timer)
    })
const step = () => {
    task(3000, 'red')
        .then(() => task(2000, 'green'))
        .then(() => task(2100, 'yellow'))
        .then(step)
}
step()
```

#### ç”¨ async/await å®ç°

```js
const task = (timer, light) => 
    new Promise((resolve, reject) => {
        setTimeout(() => {
            if (light === 'red') {
                red()
            }
            else if (light === 'green') {
                green()
            }
            else if (light === 'yellow') {
                yellow()
            }
            resolve()
        }, timer)
    })
    
const taskRunner =  async () => {
    await task(3000, 'red')
    await task(2000, 'green')
    await task(2100, 'yellow')
    taskRunner()
}
taskRunner()

```



### 2.å›¾ç‰‡æ‡’åŠ è½½

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <style>
    .container {
      width: 1000px;
      margin: 0 auto;
      background-color: pink;
    }
    .container > img {
      display: block;
      width: 400px;
      height: 400px;
      margin-bottom: 50px;
    }
  </style>
  <body>
    <div class="container">
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
      <img src="./img/loading.jpg" data-src="./img/pic.png" />
    </div>
    <script>
      function lazyLoad() {
        var scrollTop =
          document.body.scrollTop || document.documentElement.scrollTop;
        var winHeight = window.innerHeight;
        for (var i = 0; i < imgs.length; i++) {
          if (imgs[i].offsetTop < scrollTop + winHeight) {
            imgs[i].src = imgs[i].getAttribute("data-src");
          }
        }
      }
      window.onscroll = lazyLoad();
    </script>
  </body>
</html>
```



### 3.promiseå®ç°å›¾ç‰‡å¼‚æ­¥åŠ è½½

```js
let imageAsync=(url)=>{
    return new Promise((resolve,reject)=>{
        let img=new Image();
        img.src=url;
        img.onload=()=>{
            resolve(image)
        }
        img.onerror=(err)=>{
            reject(err)
        }
    })
}
imageAsync("url").then(()=>{
    console.log('åŠ è½½æˆåŠŸ')
}).catch((error)=>{
    console.log('åŠ è½½å¤±è´¥')
})
```



### 4.æ¯éš”ä¸€ç§’æ‰“å°

```js
// ä½¿ç”¨é—­åŒ…å®ç°
for (var i = 0; i < 5; i++) {
  (function(i) {
    setTimeout(function() {
      console.log(i);
    }, i * 1000);
  })(i);
}
// ä½¿ç”¨ let å—çº§ä½œç”¨åŸŸ
for (let i = 0; i < 5; i++) {
  setTimeout(function() {
    console.log(i);
  }, i * 1000);
}
```

```js
function sleep(time){
    for(let i=0;i<5;i++){
        Promise.resolve(i).then((result)=>{
            setTimeout(()=>{
                console.log(result)
            },time*result)
        })
    }
}
sleep(1000)
```



### 5.åŒå‘æ•°æ®ç»‘å®š

```js
 //=>å‘å¸ƒè®¢é˜…çš„ç±»
      class EventEmitter {
        constructor() {
          this.arrayList = {};
        }
        on(name, fn) {
          if (this.arrayList[name] && !this.arrayList[name].includes(fn)) {
            this.arrayList[name].push(fn);
          } else {
            this.arrayList[name] = [fn];
          }
          console.log(this.arrayList);
        }
        off(name, fn) {
          if (this.arrayList[name]) {
            let index = this.arrayList[name].indexOf(fn);
            this.arrayList[name].splice(index, 1);
            console.log(this.arrayList);
          }
        }
        emit(name, once = false, ...arg) {
          if (this.arrayList[name]?.length > 0) {
            for (let key of this.arrayList[name]) {
              key.call(this, arg);
            }
          }
          if (!once) {
            delete this.arrayList[name];
          }
          console.log(this.arrayList);
        }
      }
      let s1 = new EventEmitter();
      let f1 = function () {
        console.log(666);
      };
      let f2 = function () {
        console.log(777);
      };
      var input = document.querySelector("#ipt");
      input.oninput = function (e) {
        obj.value = e.target.value;
      };
      let obj = {
        value: "",
      };
      Object.defineProperty(obj, "value", {
        get() {
          console.log("æˆ‘è¢«è¯»äº†");
        },
        set(newVal) {
          s1.on("value1", function () {
            console.log("æˆ‘çš„å€¼æ˜¯" + newVal);
            console.log("æˆ‘è¢«æ”¹äº†");
          });
          input.value = newVal;
          return newVal;
        },
      });
```



### 6.è§‚å¯Ÿè€…æ¨¡å¼

åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œåªæœ‰ä¸¤ä¸ªä¸»ä½“ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡`Subject`ï¼Œè§‚å¯Ÿè€…`Observer`ã€‚

- è§‚å¯Ÿè€…éœ€`Observer`è¦å®ç°`update`æ–¹æ³•ï¼Œä¾›ç›®æ ‡å¯¹è±¡è°ƒç”¨ã€‚`update`æ–¹æ³•ä¸­å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„ä¸šåŠ¡ä»£ç ã€‚
- ç›®æ ‡å¯¹è±¡`Subject`ä¹Ÿé€šå¸¸è¢«å«åšè¢«è§‚å¯Ÿè€…æˆ–ä¸»é¢˜ï¼Œå®ƒçš„èŒèƒ½å¾ˆå•ä¸€ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œå®ƒåªç®¡ç†ä¸€ç§äº‹ä»¶ã€‚`Subject`éœ€è¦ç»´æŠ¤è‡ªèº«çš„è§‚å¯Ÿè€…æ•°ç»„`observerList`ï¼Œå½“è‡ªèº«å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡è°ƒç”¨è‡ªèº«çš„`notify`æ–¹æ³•ï¼Œä¾æ¬¡é€šçŸ¥æ¯ä¸€ä¸ªè§‚å¯Ÿè€…æ‰§è¡Œ`update`æ–¹æ³•ã€‚

![è§‚å¯Ÿè€…æ¨¡å¼](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/12/16ef7fe567bdf007~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)

```js
// è§‚å¯Ÿè€…
class Observer {
    /**
     * æ„é€ å™¨
     * @param {Function} cb å›è°ƒå‡½æ•°ï¼Œæ”¶åˆ°ç›®æ ‡å¯¹è±¡é€šçŸ¥æ—¶æ‰§è¡Œ
     */
    constructor(cb){
        if (typeof cb === 'function') {
            this.cb = cb
        } else {
            throw new Error('Observeræ„é€ å™¨å¿…é¡»ä¼ å…¥å‡½æ•°ç±»å‹ï¼')
        }
    }
    /**
     * è¢«ç›®æ ‡å¯¹è±¡é€šçŸ¥æ—¶æ‰§è¡Œ
     */
    update() {
        this.cb()
    }
}

// ç›®æ ‡å¯¹è±¡
class Subject {
    constructor() {
        // ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨
        this.observerList = []
    }
    /**
     * æ·»åŠ ä¸€ä¸ªè§‚å¯Ÿè€…
     * @param {Observer} observer Observerå®ä¾‹
     */
    addObserver(observer) {
        this.observerList.push(observer)
    }
    /**
     * é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…
     */
    notify() {
        this.observerList.forEach(observer => {
            observer.update()
        })
    }
}

const observerCallback = function() {
    console.log('æˆ‘è¢«é€šçŸ¥äº†')
}
const observer = new Observer(observerCallback)

const subject = new Subject();
subject.addObserver(observer);
subject.notify();

```

- è§’è‰²å¾ˆæ˜ç¡®ï¼Œæ²¡æœ‰äº‹ä»¶è°ƒåº¦ä¸­å¿ƒä½œä¸ºä¸­é—´è€…ï¼Œç›®æ ‡å¯¹è±¡`Subject`å’Œè§‚å¯Ÿè€…`Observer`éƒ½è¦å®ç°çº¦å®šçš„æˆå‘˜æ–¹æ³•ã€‚
- åŒæ–¹è”ç³»æ›´ç´§å¯†ï¼Œç›®æ ‡å¯¹è±¡çš„ä¸»åŠ¨æ€§å¾ˆå¼ºï¼Œè‡ªå·±æ”¶é›†å’Œç»´æŠ¤è§‚å¯Ÿè€…ï¼Œå¹¶åœ¨çŠ¶æ€å˜åŒ–æ—¶ä¸»åŠ¨é€šçŸ¥è§‚å¯Ÿè€…æ›´æ–°ã€‚

### 7.å‘å¸ƒè®¢é˜…æ¨¡å¼

![å‘å¸ƒè®¢é˜…æ¨¡å¼å›¾è§£](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/12/16ef7fe5614d6ea0~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)

```js
class PubSub {
    constructor() {
        // ç»´æŠ¤äº‹ä»¶åŠè®¢é˜…è¡Œä¸º
        this.events = {}
    }
    /**
     * æ³¨å†Œäº‹ä»¶è®¢é˜…è¡Œä¸º
     * @param {String} type äº‹ä»¶ç±»å‹
     * @param {Function} cb å›è°ƒå‡½æ•°
     */
    subscribe(type, cb) {
        if (!this.events[type]) {
            this.events[type] = []
        }
        this.events[type].push(cb)
    }
    /**
     * å‘å¸ƒäº‹ä»¶
     * @param {String} type äº‹ä»¶ç±»å‹
     * @param  {...any} args å‚æ•°åˆ—è¡¨
     */
    publish(type, ...args) {
        if (this.events[type]) {
            this.events[type].forEach(cb => {
                cb(...args)
            })
        }
    }
    /**
     * ç§»é™¤æŸä¸ªäº‹ä»¶çš„ä¸€ä¸ªè®¢é˜…è¡Œä¸º
     * @param {String} type äº‹ä»¶ç±»å‹
     * @param {Function} cb å›è°ƒå‡½æ•°
     */
    unsubscribe(type, cb) {
        if (this.events[type]) {
            const targetIndex = this.events[type].findIndex(item => item === cb)
            if (targetIndex !== -1) {
                this.events[type].splice(targetIndex, 1)
            }
            if (this.events[type].length === 0) {
                delete this.events[type]
            }
        }
    }
    /**
     * ç§»é™¤æŸä¸ªäº‹ä»¶çš„æ‰€æœ‰è®¢é˜…è¡Œä¸º
     * @param {String} type äº‹ä»¶ç±»å‹
     */
    unsubscribeAll(type) {
        if (this.events[type]) {
            delete this.events[type]
        }
    }
}

```

å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œå¯¹äºå‘å¸ƒè€…`Publisher`å’Œè®¢é˜…è€…`Subscriber`æ²¡æœ‰ç‰¹æ®Šçš„çº¦æŸï¼Œä»–ä»¬å¥½ä¼¼æ˜¯åŒ¿åæ´»åŠ¨ï¼Œå€ŸåŠ©äº‹ä»¶è°ƒåº¦ä¸­å¿ƒæä¾›çš„æ¥å£å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶ï¼Œäº’ä¸äº†è§£å¯¹æ–¹æ˜¯è°ã€‚

æ¾æ•£è€¦åˆï¼Œçµæ´»åº¦é«˜ï¼Œå¸¸ç”¨ä½œäº‹ä»¶æ€»çº¿

æ˜“ç†è§£ï¼Œå¯ç±»æ¯”äº`DOM`äº‹ä»¶ä¸­çš„`dispatchEvent`å’Œ`addEventListener`ã€‚

### 8.å•ä¾‹æ¨¡å¼

[ç›¸å…³æ–‡ç« ](https://juejin.cn/post/6844903874210299912)

### 9.å·¥å‚æ¨¡å¼

[ç›¸å…³æ–‡ç« ](https://juejin.cn/post/6844903474639929357)

### 10.Eventbus

```js
class EventBus{
  constructor(){
    this._cache = {}
  }

  on(type,callback){
    this._cache[type] = this._cache[type] || []
    this._cache[type].push(callback)
  }

  off(type,callback){
    const fns = this._cache[type]
    if(!Array.isArray(fns)){
      return
    }

    if(!callback){
      fns.length = 0
      return
    }

    while(fns.indexOf(callback) !== -1){
      fns.splice(fns.indexOf(callback),1)
    }
  }

  emit(type,data){
    const fns = this._cache[type]
    if(!Array.isArray(fns)){
      return
    }

    fns.forEach(item => {
      item(data)
    })
  }
}

const bus = new EventBus()

function cyCallback1(res){
  console.log('cy on1: ',res)
}

function cyCallback2(res){
  console.log('cy on2: ',res)
}

bus.on('cy',cyCallback1)
bus.on('cy',cyCallback1)

bus.on('cy',cyCallback2)

bus.off('cy',cyCallback1)

bus.emit('cy','cy emit')

```

### 11.å®ç°checkboxå…¨é€‰åé€‰

jså®ç°

```js
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<style type="text/css">
			* {
				padding: 0px;
				margin: 0px auto;
			}			
			body {
				padding: 30px;
				width: 300px;
				height: 300px;
			}
		</style>
		<script type="text/javascript">
			window.onload = function() {
				//è·å–äº”ä¸ªå¤šé€‰æ¡†items
				var items = document.getElementsByName("items");

				//1.checkAllBtnç»‘å®šå•å‡»å“åº”å‡½æ•°
				var checkAllBtn = document.getElementById("checkAllBtn");
				checkAllBtn.onclick = function() {
					//éå†items,ä½¿æ¯ä¸ªå¤é€‰æ¡†éƒ½è¢«é€‰ä¸­
					for(var i = 0; i < items.length; i++) {
						items[i].checked = true;
					}
				};

				//2.checkNoBtnç»‘å®šå•å‡»å“åº”å‡½æ•°
				var checkNoBtn = document.getElementById("checkNoBtn");
				checkNoBtn.onclick = function() {
					//éå†items,ä½¿æ¯ä¸ªå¤é€‰æ¡†éƒ½ä¸è¢«é€‰ä¸­
					for(var i = 0; i < items.length; i++) {
						items[i].checked = false;
					}
				};

				//3.checkRevBtnç»‘å®šå•å‡»å“åº”å‡½æ•°
				var checkRevBtn = document.getElementById("checkRevBtn");
				checkRevBtn.onclick = function() {
					//éå†items,è¿›è¡Œåé€‰
					for(var i = 0; i < items.length; i++) {
//						if(items[i].checked) {
//							items[i].checked = false;
//						} else if(items[i].checked == false) {
//							items[i].checked = true;
//						}
						items[i].checked = !items[i].checked;
					}

				};

			};
		</script>
	</head>

	<body>
		<input type="button" id="checkAllBtn" value="å…¨é€‰" />
		<input type="button" id="checkNoBtn" value="ä¸é€‰" />
		<input type="button" id="checkRevBtn" value="åé€‰" />
		<div id="select">
			<input type="checkbox" name="items" value="æ—…æ¸¸" />æ—…æ¸¸<br />
			<input type="checkbox" name="items" value="é˜…è¯»" />é˜…è¯»<br />
			<input type="checkbox" name="items" value="è¿åŠ¨" />è¿åŠ¨<br />
			<input type="checkbox" name="items" value="éŸ³ä¹" />éŸ³ä¹<br />
			<input type="checkbox" name="items" value="è·³èˆ" />è·³èˆ
		</div>
	</body>
</html>
```

vueå®ç°

```vue
<template>
  <div>
    <span>å…¨é€‰</span>
    <input type="checkbox" v-model="checkAll" />
    <div v-for="(item,index) in test" :key="index">
      <span>{{item.name}}</span>
	  <input type="checkbox" v-model="item.isSelected" />
    </div>
  </div>
</template>
<script>
  export default {
  data() {
    return {
      test: [
        { name: "æµ‹è¯•1", isSelected: true },
        { name: "æµ‹è¯•2", isSelected: true },
        { name: "æµ‹è¯•3", isSelected: true },
        { name: "æµ‹è¯•4", isSelected: true },
        { name: "æµ‹è¯•5", isSelected: true }
      ]
    };
  },
  computed: {
    checkAll: {
      get() {
        // è¿”å›ä»€ä¹ˆç»“æœæ¥èµ‹äºˆç»™ checkAll å±æ€§
        return this.test.every(item => item.isSelected);
      },
      set(val) {
        // val æ˜¯ç»™ checkAll èµ‹äºˆå€¼çš„æ—¶å€™ä¼ é€’è¿‡æ¥çš„
        return this.test.forEach(item => (item.isSelected = val));
      }
    }
  }
}
</script>
```

### 12.å®ç°å¯æ‹–æ‹½div

```js
<div id="dragdiv"></div>

var  dragging=false;
var position =null;

dragdiv.addEventListener('mousedown',function(e){
	dragging=true
	position=[e.clientX,e.clientY]
})
document.addEventListener('mousemove',function(e){
	if(dragging===false)  return null
	const x=e.clientX
	const y=e.clientY
	const deltaX=x-position[0]
	const deltaY=y-position[1]
	const left=parseInt(dragdiv.style.left||0)
	const top=parseInt(dragdiv.style.top||0)
	dragdiv.style.left=left+deltaX+'px'
	dragdiv.style.top=top+deltaY+'px'
	position=[x,y]
})
document.addEventListener('mouseup',function(e){
	dragging=false
})
```

### 13.å°è£…å¼‚æ­¥çš„fetchï¼Œä½¿ç”¨async awaitæ–¹å¼æ¥ä½¿ç”¨

```js
(async () => {
    class HttpRequestUtil {
        async get(url) {
            const res = await fetch(url);
            const data = await res.json();
            return data;
        }
        async post(url, data) {
            const res = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            return result;
        }
        async put(url, data) {
            const res = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(data)
            });
            const result = await res.json();
            return result;
        }
        async delete(url, data) {
            const res = await fetch(url, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify(data)
            });
            const result = await res.json();
            return result;
        }
    }
    const httpRequestUtil = new HttpRequestUtil();
    const res = await httpRequestUtil.get('http://golderbrother.cn/');
    console.log(res);
})();
```

### 14.å®ç°ç®€å•è·¯ç”±

```js
// hashè·¯ç”±
class Route{
  constructor(){
    // è·¯ç”±å­˜å‚¨å¯¹è±¡
    this.routes = {}
    // å½“å‰hash
    this.currentHash = ''
    // ç»‘å®šthisï¼Œé¿å…ç›‘å¬æ—¶thisæŒ‡å‘æ”¹å˜
    this.freshRoute = this.freshRoute.bind(this)
    // ç›‘å¬
    window.addEventListener('load', this.freshRoute, false)
    window.addEventListener('hashchange', this.freshRoute, false)
  }
  // å­˜å‚¨
  storeRoute (path, cb) {
    this.routes[path] = cb || function () {}
  }
  // æ›´æ–°
  freshRoute () {
    this.currentHash = location.hash.slice(1) || '/'
    this.routes[this.currentHash]()
  }
}

```

### 15.åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨

```js
const isCycleObject = (obj,parent) => {
    const parentArr = parent || [obj];
    for(let i in obj) {
        if(typeof obj[i] === 'object') {
            let flag = false;
            parentArr.forEach((pObj) => {
                if(pObj === obj[i]){
                    flag = true;
                }
            })
            if(flag) return true;
            flag = isCycleObject(obj[i],[...parentArr,obj[i]]);
            if(flag) return true;
        }
    }
    return false;
}


const a = 1;
const b = {a};
const c = {b};
const o = {d:{a:3},c}
o.c.b.aa = a;

console.log(isCycleObject(o)
```

### 16.å®ç°å¹¶å‘æ§åˆ¶

åŒæ—¶è¿›è¡Œ2ä¸ªå¹¶å‘è¯·æ±‚

```js
class Scheduler{
	list=[];
	maxNum=2;
	workingNum=0;
	add(promiseCreator){
		this.list.push(promiseCreator)
	}
	start(){
			for(let i=0;i<this.maxNum;i++){
				this.doNext()
			}
	}
	doNext(){
		if(this.list.length&&this.workingNum<this.maxNum){
			this.workingNum++
			this.list.shift()().then(()=>{
				this.workingNum--
				this.doNext()
			})
		}
	}
}
var timeout=time=>new Promise(resolve=>setTimeout(resolve,time))

var scheduler=new Scheduler()

var addTask=(time,order)=>{
	scheduler.add(()=>timeout(time).then(()=>console.log(order)))
}
addTask(1000,1)
addTask(500,2)
addTask(300,3)
addTask(400,4)

scheduler.start()
```

